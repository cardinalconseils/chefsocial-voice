"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/auth/route";
exports.ids = ["app/api/auth/route"];
exports.modules = {

/***/ "better-sqlite3":
/*!*********************************!*\
  !*** external "better-sqlite3" ***!
  \*********************************/
/***/ ((module) => {

module.exports = require("better-sqlite3");

/***/ }),

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "buffer":
/*!*************************!*\
  !*** external "buffer" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("buffer");

/***/ }),

/***/ "child_process":
/*!********************************!*\
  !*** external "child_process" ***!
  \********************************/
/***/ ((module) => {

module.exports = require("child_process");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("crypto");

/***/ }),

/***/ "events":
/*!*************************!*\
  !*** external "events" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("events");

/***/ }),

/***/ "fs":
/*!*********************!*\
  !*** external "fs" ***!
  \*********************/
/***/ ((module) => {

module.exports = require("fs");

/***/ }),

/***/ "http":
/*!***********************!*\
  !*** external "http" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("http");

/***/ }),

/***/ "https":
/*!************************!*\
  !*** external "https" ***!
  \************************/
/***/ ((module) => {

module.exports = require("https");

/***/ }),

/***/ "path":
/*!***********************!*\
  !*** external "path" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("path");

/***/ }),

/***/ "stream":
/*!*************************!*\
  !*** external "stream" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("stream");

/***/ }),

/***/ "util":
/*!***********************!*\
  !*** external "util" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("util");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fauth%2Froute&page=%2Fapi%2Fauth%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fauth%2Froute.ts&appDir=%2FUsers%2Fpierre-marccardinal%2FDocuments%2Fchefsocial-voice%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fpierre-marccardinal%2FDocuments%2Fchefsocial-voice&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fauth%2Froute&page=%2Fapi%2Fauth%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fauth%2Froute.ts&appDir=%2FUsers%2Fpierre-marccardinal%2FDocuments%2Fchefsocial-voice%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fpierre-marccardinal%2FDocuments%2Fchefsocial-voice&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _Users_pierre_marccardinal_Documents_chefsocial_voice_src_app_api_auth_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./src/app/api/auth/route.ts */ \"(rsc)/./src/app/api/auth/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/auth/route\",\n        pathname: \"/api/auth\",\n        filename: \"route\",\n        bundlePath: \"app/api/auth/route\"\n    },\n    resolvedPagePath: \"/Users/pierre-marccardinal/Documents/chefsocial-voice/src/app/api/auth/route.ts\",\n    nextConfigOutput,\n    userland: _Users_pierre_marccardinal_Documents_chefsocial_voice_src_app_api_auth_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/auth/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZhdXRoJTJGcm91dGUmcGFnZT0lMkZhcGklMkZhdXRoJTJGcm91dGUmYXBwUGF0aHM9JnBhZ2VQYXRoPXByaXZhdGUtbmV4dC1hcHAtZGlyJTJGYXBpJTJGYXV0aCUyRnJvdXRlLnRzJmFwcERpcj0lMkZVc2VycyUyRnBpZXJyZS1tYXJjY2FyZGluYWwlMkZEb2N1bWVudHMlMkZjaGVmc29jaWFsLXZvaWNlJTJGc3JjJTJGYXBwJnBhZ2VFeHRlbnNpb25zPXRzeCZwYWdlRXh0ZW5zaW9ucz10cyZwYWdlRXh0ZW5zaW9ucz1qc3gmcGFnZUV4dGVuc2lvbnM9anMmcm9vdERpcj0lMkZVc2VycyUyRnBpZXJyZS1tYXJjY2FyZGluYWwlMkZEb2N1bWVudHMlMkZjaGVmc29jaWFsLXZvaWNlJmlzRGV2PXRydWUmdHNjb25maWdQYXRoPXRzY29uZmlnLmpzb24mYmFzZVBhdGg9JmFzc2V0UHJlZml4PSZuZXh0Q29uZmlnT3V0cHV0PSZwcmVmZXJyZWRSZWdpb249Jm1pZGRsZXdhcmVDb25maWc9ZTMwJTNEISIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7QUFBc0c7QUFDdkM7QUFDYztBQUMrQjtBQUM1RztBQUNBO0FBQ0E7QUFDQSx3QkFBd0IsZ0hBQW1CO0FBQzNDO0FBQ0EsY0FBYyx5RUFBUztBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsWUFBWTtBQUNaLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQSxRQUFRLGlFQUFpRTtBQUN6RTtBQUNBO0FBQ0EsV0FBVyw0RUFBVztBQUN0QjtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ3VIOztBQUV2SCIsInNvdXJjZXMiOlsid2VicGFjazovL2NoZWZzb2NpYWwtbmV4dC8/NTgxYiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBcHBSb3V0ZVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLW1vZHVsZXMvYXBwLXJvdXRlL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLWtpbmRcIjtcbmltcG9ydCB7IHBhdGNoRmV0Y2ggYXMgX3BhdGNoRmV0Y2ggfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9saWIvcGF0Y2gtZmV0Y2hcIjtcbmltcG9ydCAqIGFzIHVzZXJsYW5kIGZyb20gXCIvVXNlcnMvcGllcnJlLW1hcmNjYXJkaW5hbC9Eb2N1bWVudHMvY2hlZnNvY2lhbC12b2ljZS9zcmMvYXBwL2FwaS9hdXRoL3JvdXRlLnRzXCI7XG4vLyBXZSBpbmplY3QgdGhlIG5leHRDb25maWdPdXRwdXQgaGVyZSBzbyB0aGF0IHdlIGNhbiB1c2UgdGhlbSBpbiB0aGUgcm91dGVcbi8vIG1vZHVsZS5cbmNvbnN0IG5leHRDb25maWdPdXRwdXQgPSBcIlwiXG5jb25zdCByb3V0ZU1vZHVsZSA9IG5ldyBBcHBSb3V0ZVJvdXRlTW9kdWxlKHtcbiAgICBkZWZpbml0aW9uOiB7XG4gICAgICAgIGtpbmQ6IFJvdXRlS2luZC5BUFBfUk9VVEUsXG4gICAgICAgIHBhZ2U6IFwiL2FwaS9hdXRoL3JvdXRlXCIsXG4gICAgICAgIHBhdGhuYW1lOiBcIi9hcGkvYXV0aFwiLFxuICAgICAgICBmaWxlbmFtZTogXCJyb3V0ZVwiLFxuICAgICAgICBidW5kbGVQYXRoOiBcImFwcC9hcGkvYXV0aC9yb3V0ZVwiXG4gICAgfSxcbiAgICByZXNvbHZlZFBhZ2VQYXRoOiBcIi9Vc2Vycy9waWVycmUtbWFyY2NhcmRpbmFsL0RvY3VtZW50cy9jaGVmc29jaWFsLXZvaWNlL3NyYy9hcHAvYXBpL2F1dGgvcm91dGUudHNcIixcbiAgICBuZXh0Q29uZmlnT3V0cHV0LFxuICAgIHVzZXJsYW5kXG59KTtcbi8vIFB1bGwgb3V0IHRoZSBleHBvcnRzIHRoYXQgd2UgbmVlZCB0byBleHBvc2UgZnJvbSB0aGUgbW9kdWxlLiBUaGlzIHNob3VsZFxuLy8gYmUgZWxpbWluYXRlZCB3aGVuIHdlJ3ZlIG1vdmVkIHRoZSBvdGhlciByb3V0ZXMgdG8gdGhlIG5ldyBmb3JtYXQuIFRoZXNlXG4vLyBhcmUgdXNlZCB0byBob29rIGludG8gdGhlIHJvdXRlLlxuY29uc3QgeyByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcyB9ID0gcm91dGVNb2R1bGU7XG5jb25zdCBvcmlnaW5hbFBhdGhuYW1lID0gXCIvYXBpL2F1dGgvcm91dGVcIjtcbmZ1bmN0aW9uIHBhdGNoRmV0Y2goKSB7XG4gICAgcmV0dXJuIF9wYXRjaEZldGNoKHtcbiAgICAgICAgc2VydmVySG9va3MsXG4gICAgICAgIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2VcbiAgICB9KTtcbn1cbmV4cG9ydCB7IHJvdXRlTW9kdWxlLCByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcywgb3JpZ2luYWxQYXRobmFtZSwgcGF0Y2hGZXRjaCwgIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFwcC1yb3V0ZS5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fauth%2Froute&page=%2Fapi%2Fauth%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fauth%2Froute.ts&appDir=%2FUsers%2Fpierre-marccardinal%2FDocuments%2Fchefsocial-voice%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fpierre-marccardinal%2FDocuments%2Fchefsocial-voice&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./src/app/api/auth/route.ts":
/*!***********************************!*\
  !*** ./src/app/api/auth/route.ts ***!
  \***********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   DELETE: () => (/* binding */ DELETE),\n/* harmony export */   GET: () => (/* binding */ GET),\n/* harmony export */   POST: () => (/* binding */ POST)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var stripe__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! stripe */ \"(rsc)/./node_modules/stripe/esm/stripe.esm.node.js\");\n/* harmony import */ var _lib_database__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../lib/database */ \"(rsc)/./src/lib/database.ts\");\n/* harmony import */ var _lib_auth__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../lib/auth */ \"(rsc)/./src/lib/auth.ts\");\n/* harmony import */ var _lib_validation__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../lib/validation */ \"(rsc)/./src/lib/validation.ts\");\n\n\n\n\n\n// Initialize Stripe\nconst stripe = new stripe__WEBPACK_IMPORTED_MODULE_1__[\"default\"](process.env.STRIPE_SECRET_KEY || \"\", {\n    apiVersion: \"2025-05-28.basil\"\n});\n// POST /api/auth - Handle login, register, and token refresh\nasync function POST(request) {\n    try {\n        const body = await request.json();\n        const { action } = body;\n        // Handle token refresh\n        if (action === \"refresh\") {\n            return handleTokenRefresh(body);\n        }\n        // Validate auth request (login or register)\n        const validation = (0,_lib_validation__WEBPACK_IMPORTED_MODULE_4__.validateInput)(_lib_validation__WEBPACK_IMPORTED_MODULE_4__.authRequestSchema, body);\n        if (!validation.success) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                error: \"Validation failed\",\n                details: validation.errors\n            }, {\n                status: 400\n            });\n        }\n        const validatedData = validation.data;\n        if (validatedData.action === \"login\") {\n            return handleLogin(validatedData);\n        } else if (validatedData.action === \"register\") {\n            return handleRegister(validatedData);\n        }\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            success: false,\n            error: \"Invalid action\"\n        }, {\n            status: 400\n        });\n    } catch (error) {\n        console.error(\"Auth API error:\", error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            success: false,\n            error: _lib_validation__WEBPACK_IMPORTED_MODULE_4__.ERROR_MESSAGES.INTERNAL_ERROR\n        }, {\n            status: 500\n        });\n    }\n}\n// Handle user login\nasync function handleLogin(data) {\n    try {\n        const email = (0,_lib_validation__WEBPACK_IMPORTED_MODULE_4__.sanitizeEmail)(data.email);\n        // Find user in database\n        const user = _lib_database__WEBPACK_IMPORTED_MODULE_2__.database.getUserByEmail(email);\n        if (!user) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                error: _lib_validation__WEBPACK_IMPORTED_MODULE_4__.ERROR_MESSAGES.INVALID_CREDENTIALS,\n                message: \"Email or password is incorrect\"\n            }, {\n                status: 401\n            });\n        }\n        // Verify password\n        const isValidPassword = await _lib_auth__WEBPACK_IMPORTED_MODULE_3__.authService.verifyPassword(data.password, user.passwordHash);\n        if (!isValidPassword) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                error: _lib_validation__WEBPACK_IMPORTED_MODULE_4__.ERROR_MESSAGES.INVALID_CREDENTIALS,\n                message: \"Email or password is incorrect\"\n            }, {\n                status: 401\n            });\n        }\n        // Update last login timestamp\n        _lib_database__WEBPACK_IMPORTED_MODULE_2__.database.updateLastLogin(user.id);\n        // Create auth tokens\n        const tokens = _lib_auth__WEBPACK_IMPORTED_MODULE_3__.authService.createAuthTokens(user);\n        // Return success response with tokens\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            success: true,\n            message: \"Login successful\",\n            user: _lib_auth__WEBPACK_IMPORTED_MODULE_3__.authService.toPublicUser(user),\n            accessToken: tokens.accessToken,\n            refreshToken: tokens.refreshToken\n        });\n    } catch (error) {\n        console.error(\"Login error:\", error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            success: false,\n            error: _lib_validation__WEBPACK_IMPORTED_MODULE_4__.ERROR_MESSAGES.INTERNAL_ERROR\n        }, {\n            status: 500\n        });\n    }\n}\n// Handle user registration\nasync function handleRegister(data) {\n    try {\n        const email = (0,_lib_validation__WEBPACK_IMPORTED_MODULE_4__.sanitizeEmail)(data.email);\n        // Check if user already exists\n        const existingUser = _lib_database__WEBPACK_IMPORTED_MODULE_2__.database.getUserByEmail(email);\n        if (existingUser) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                error: _lib_validation__WEBPACK_IMPORTED_MODULE_4__.ERROR_MESSAGES.USER_EXISTS,\n                message: \"An account with this email already exists\"\n            }, {\n                status: 409\n            });\n        }\n        // Hash password\n        const passwordHash = await _lib_auth__WEBPACK_IMPORTED_MODULE_3__.authService.hashPassword(data.password);\n        // Create Stripe customer\n        let stripeCustomerId;\n        try {\n            const stripeCustomer = await stripe.customers.create({\n                email,\n                name: data.name,\n                metadata: {\n                    restaurant_name: data.restaurantName,\n                    cuisine_type: data.cuisineType || \"\",\n                    location: data.location || \"\",\n                    phone: data.phone || \"\",\n                    source: \"chefsocial_registration\",\n                    marketing_consent: data.marketingConsent?.toString() || \"false\"\n                }\n            });\n            stripeCustomerId = stripeCustomer.id;\n        } catch (stripeError) {\n            console.error(\"Stripe customer creation failed:\", stripeError);\n        // Continue with registration even if Stripe fails\n        }\n        // Prepare user data\n        const trialStartDate = new Date().toISOString();\n        const trialEndDate = new Date(Date.now() + 14 * 24 * 60 * 60 * 1000).toISOString();\n        const userData = {\n            email,\n            passwordHash,\n            name: data.name,\n            restaurantName: data.restaurantName,\n            cuisineType: data.cuisineType,\n            location: data.location,\n            phone: data.phone,\n            role: \"user\",\n            subscriptionStatus: \"trialing\",\n            trialStartDate,\n            trialEndDate,\n            stripeCustomerId,\n            stripeSubscriptionId: undefined,\n            marketingConsent: data.marketingConsent || false,\n            emailVerified: false,\n            onboardingCompleted: false\n        };\n        // Create user in database\n        const newUser = await _lib_database__WEBPACK_IMPORTED_MODULE_2__.database.createUser(userData);\n        // Create auth tokens\n        const tokens = _lib_auth__WEBPACK_IMPORTED_MODULE_3__.authService.createAuthTokens(newUser);\n        // Return success response\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            success: true,\n            message: \"Registration successful\",\n            user: _lib_auth__WEBPACK_IMPORTED_MODULE_3__.authService.toPublicUser(newUser),\n            accessToken: tokens.accessToken,\n            refreshToken: tokens.refreshToken\n        }, {\n            status: 201\n        });\n    } catch (error) {\n        console.error(\"Registration error:\", error);\n        if (error instanceof Error && error.message.includes(\"already exists\")) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                error: _lib_validation__WEBPACK_IMPORTED_MODULE_4__.ERROR_MESSAGES.USER_EXISTS,\n                message: \"An account with this email already exists\"\n            }, {\n                status: 409\n            });\n        }\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            success: false,\n            error: _lib_validation__WEBPACK_IMPORTED_MODULE_4__.ERROR_MESSAGES.INTERNAL_ERROR\n        }, {\n            status: 500\n        });\n    }\n}\n// Handle token refresh\nasync function handleTokenRefresh(body) {\n    try {\n        // Validate refresh token request\n        const validation = (0,_lib_validation__WEBPACK_IMPORTED_MODULE_4__.validateInput)(_lib_validation__WEBPACK_IMPORTED_MODULE_4__.refreshTokenRequestSchema, body);\n        if (!validation.success) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                error: \"Invalid refresh token format\",\n                details: validation.errors\n            }, {\n                status: 400\n            });\n        }\n        const { refreshToken } = validation.data;\n        // Refresh the access token\n        const result = await _lib_auth__WEBPACK_IMPORTED_MODULE_3__.authService.refreshAccessToken(refreshToken);\n        if (!result.success) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                error: result.error || \"Token refresh failed\"\n            }, {\n                status: 401\n            });\n        }\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            success: true,\n            message: \"Token refreshed successfully\",\n            accessToken: result.accessToken,\n            refreshToken: result.refreshToken\n        });\n    } catch (error) {\n        console.error(\"Token refresh error:\", error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            success: false,\n            error: \"Token refresh failed\"\n        }, {\n            status: 500\n        });\n    }\n}\n// POST /api/auth/logout - Handle logout (revoke refresh token)\nasync function DELETE(request) {\n    try {\n        const body = await request.json();\n        const { refreshToken, logoutAll = false } = body;\n        if (logoutAll) {\n            // Logout from all devices - need user ID\n            const user = await _lib_auth__WEBPACK_IMPORTED_MODULE_3__.authService.getUserFromRequest(request);\n            if (user) {\n                _lib_auth__WEBPACK_IMPORTED_MODULE_3__.authService.revokeAllUserTokens(user.id);\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    success: true,\n                    message: \"Logged out from all devices\"\n                });\n            }\n        } else if (refreshToken) {\n            // Logout from current device\n            const success = _lib_auth__WEBPACK_IMPORTED_MODULE_3__.authService.revokeRefreshToken(refreshToken);\n            if (success) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    success: true,\n                    message: \"Logout successful\"\n                });\n            }\n        }\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            success: false,\n            error: \"Logout failed\"\n        }, {\n            status: 400\n        });\n    } catch (error) {\n        console.error(\"Logout error:\", error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            success: false,\n            error: \"Logout failed\"\n        }, {\n            status: 500\n        });\n    }\n}\n// GET /api/auth/me - Get current user info\nasync function GET(request) {\n    try {\n        const user = await _lib_auth__WEBPACK_IMPORTED_MODULE_3__.authService.getUserFromRequest(request);\n        if (!user) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                error: \"Not authenticated\"\n            }, {\n                status: 401\n            });\n        }\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            success: true,\n            user: _lib_auth__WEBPACK_IMPORTED_MODULE_3__.authService.toPublicUser(user)\n        });\n    } catch (error) {\n        console.error(\"Get user error:\", error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            success: false,\n            error: _lib_validation__WEBPACK_IMPORTED_MODULE_4__.ERROR_MESSAGES.INTERNAL_ERROR\n        }, {\n            status: 500\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUNuQjtBQUNGO0FBRUEsMkNBQTJDO0FBQ3BDLGVBQWVrRSxJQUFJNUUsT0FBb0I7SUFDNUMsSUFBSTtRQUNGLE1BQU1rQixPQUFPLE1BQU05QixrREFBV0EsQ0FBQ3FGLGtCQUFrQixDQUFDekU7UUFFbEQsSUFBSSxDQUFDa0IsTUFBTTtZQUNULE9BQU9qQyxxREFBWUEsQ0FBQ2lCLElBQUksQ0FBQztnQkFDdkJJLFNBQVM7Z0JBQ1RDLE9BQU87WUFDVCxHQUFHO2dCQUFFRyxRQUFRO1lBQUk7UUFDbkI7UUFFQSxPQUFPekIscURBQVlBLENBQUNpQixJQUFJLENBQUM7WUFDdkJJLFNBQVM7WUFDVFksTUFBTTlCLGtEQUFXQSxDQUFDMEMsWUFBWSxDQUFDWjtRQUNqQztJQUVGLEVBQUUsT0FBT1gsT0FBTztRQUNkUSxRQUFRUixLQUFLLENBQUMsbUJBQW1CQTtRQUNqQyxPQUFPdEIscURBQVlBLENBQUNpQixJQUFJLENBQUM7WUFDdkJJLFNBQVM7WUFDVEMsT0FBT2QsMkRBQWNBLENBQUN1QixjQUFjO1FBQ3RDLEdBQUc7WUFBRU4sUUFBUTtRQUFJO0lBQ25CO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9jaGVmc29jaWFsLW5leHQvLi9zcmMvYXBwL2FwaS9hdXRoL3JvdXRlLnRzP2E3NjYiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTmV4dFJlcXVlc3QsIE5leHRSZXNwb25zZSB9IGZyb20gJ25leHQvc2VydmVyJztcbmltcG9ydCBTdHJpcGUgZnJvbSAnc3RyaXBlJztcbmltcG9ydCB7IGRhdGFiYXNlIH0gZnJvbSAnLi4vLi4vLi4vbGliL2RhdGFiYXNlJztcbmltcG9ydCB7IGF1dGhTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vLi4vbGliL2F1dGgnO1xuaW1wb3J0IHsgdmFsaWRhdGVJbnB1dCwgYXV0aFJlcXVlc3RTY2hlbWEsIHJlZnJlc2hUb2tlblJlcXVlc3RTY2hlbWEsIHNhbml0aXplRW1haWwsIEVSUk9SX01FU1NBR0VTIH0gZnJvbSAnLi4vLi4vLi4vbGliL3ZhbGlkYXRpb24nO1xuXG4vLyBJbml0aWFsaXplIFN0cmlwZVxuY29uc3Qgc3RyaXBlID0gbmV3IFN0cmlwZShwcm9jZXNzLmVudi5TVFJJUEVfU0VDUkVUX0tFWSB8fCAnJywge1xuICBhcGlWZXJzaW9uOiAnMjAyNS0wNS0yOC5iYXNpbCcsXG59KTtcblxuLy8gUE9TVCAvYXBpL2F1dGggLSBIYW5kbGUgbG9naW4sIHJlZ2lzdGVyLCBhbmQgdG9rZW4gcmVmcmVzaFxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIFBPU1QocmVxdWVzdDogTmV4dFJlcXVlc3QpIHtcbiAgdHJ5IHtcbiAgICBjb25zdCBib2R5ID0gYXdhaXQgcmVxdWVzdC5qc29uKCk7XG4gICAgY29uc3QgeyBhY3Rpb24gfSA9IGJvZHk7XG5cbiAgICAvLyBIYW5kbGUgdG9rZW4gcmVmcmVzaFxuICAgIGlmIChhY3Rpb24gPT09ICdyZWZyZXNoJykge1xuICAgICAgcmV0dXJuIGhhbmRsZVRva2VuUmVmcmVzaChib2R5KTtcbiAgICB9XG5cbiAgICAvLyBWYWxpZGF0ZSBhdXRoIHJlcXVlc3QgKGxvZ2luIG9yIHJlZ2lzdGVyKVxuICAgIGNvbnN0IHZhbGlkYXRpb24gPSB2YWxpZGF0ZUlucHV0KGF1dGhSZXF1ZXN0U2NoZW1hLCBib2R5KTtcbiAgICBpZiAoIXZhbGlkYXRpb24uc3VjY2Vzcykge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIGVycm9yOiAnVmFsaWRhdGlvbiBmYWlsZWQnLFxuICAgICAgICBkZXRhaWxzOiB2YWxpZGF0aW9uLmVycm9yc1xuICAgICAgfSwgeyBzdGF0dXM6IDQwMCB9KTtcbiAgICB9XG5cbiAgICBjb25zdCB2YWxpZGF0ZWREYXRhID0gdmFsaWRhdGlvbi5kYXRhITtcblxuICAgIGlmICh2YWxpZGF0ZWREYXRhLmFjdGlvbiA9PT0gJ2xvZ2luJykge1xuICAgICAgcmV0dXJuIGhhbmRsZUxvZ2luKHZhbGlkYXRlZERhdGEpO1xuICAgIH0gZWxzZSBpZiAodmFsaWRhdGVkRGF0YS5hY3Rpb24gPT09ICdyZWdpc3RlcicpIHtcbiAgICAgIHJldHVybiBoYW5kbGVSZWdpc3Rlcih2YWxpZGF0ZWREYXRhKTtcbiAgICB9XG5cbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xuICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICBlcnJvcjogJ0ludmFsaWQgYWN0aW9uJ1xuICAgIH0sIHsgc3RhdHVzOiA0MDAgfSk7XG5cbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdBdXRoIEFQSSBlcnJvcjonLCBlcnJvcik7XG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgZXJyb3I6IEVSUk9SX01FU1NBR0VTLklOVEVSTkFMX0VSUk9SXG4gICAgfSwgeyBzdGF0dXM6IDUwMCB9KTtcbiAgfVxufVxuXG4vLyBIYW5kbGUgdXNlciBsb2dpblxuYXN5bmMgZnVuY3Rpb24gaGFuZGxlTG9naW4oZGF0YTogeyBlbWFpbDogc3RyaW5nOyBwYXNzd29yZDogc3RyaW5nIH0pIHtcbiAgdHJ5IHtcbiAgICBjb25zdCBlbWFpbCA9IHNhbml0aXplRW1haWwoZGF0YS5lbWFpbCk7XG5cbiAgICAvLyBGaW5kIHVzZXIgaW4gZGF0YWJhc2VcbiAgICBjb25zdCB1c2VyID0gZGF0YWJhc2UuZ2V0VXNlckJ5RW1haWwoZW1haWwpO1xuICAgIGlmICghdXNlcikge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIGVycm9yOiBFUlJPUl9NRVNTQUdFUy5JTlZBTElEX0NSRURFTlRJQUxTLFxuICAgICAgICBtZXNzYWdlOiAnRW1haWwgb3IgcGFzc3dvcmQgaXMgaW5jb3JyZWN0J1xuICAgICAgfSwgeyBzdGF0dXM6IDQwMSB9KTtcbiAgICB9XG5cbiAgICAvLyBWZXJpZnkgcGFzc3dvcmRcbiAgICBjb25zdCBpc1ZhbGlkUGFzc3dvcmQgPSBhd2FpdCBhdXRoU2VydmljZS52ZXJpZnlQYXNzd29yZChkYXRhLnBhc3N3b3JkLCB1c2VyLnBhc3N3b3JkSGFzaCk7XG4gICAgaWYgKCFpc1ZhbGlkUGFzc3dvcmQpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBlcnJvcjogRVJST1JfTUVTU0FHRVMuSU5WQUxJRF9DUkVERU5USUFMUyxcbiAgICAgICAgbWVzc2FnZTogJ0VtYWlsIG9yIHBhc3N3b3JkIGlzIGluY29ycmVjdCdcbiAgICAgIH0sIHsgc3RhdHVzOiA0MDEgfSk7XG4gICAgfVxuXG4gICAgLy8gVXBkYXRlIGxhc3QgbG9naW4gdGltZXN0YW1wXG4gICAgZGF0YWJhc2UudXBkYXRlTGFzdExvZ2luKHVzZXIuaWQpO1xuXG4gICAgLy8gQ3JlYXRlIGF1dGggdG9rZW5zXG4gICAgY29uc3QgdG9rZW5zID0gYXV0aFNlcnZpY2UuY3JlYXRlQXV0aFRva2Vucyh1c2VyKTtcblxuICAgIC8vIFJldHVybiBzdWNjZXNzIHJlc3BvbnNlIHdpdGggdG9rZW5zXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICBtZXNzYWdlOiAnTG9naW4gc3VjY2Vzc2Z1bCcsXG4gICAgICB1c2VyOiBhdXRoU2VydmljZS50b1B1YmxpY1VzZXIodXNlciksXG4gICAgICBhY2Nlc3NUb2tlbjogdG9rZW5zLmFjY2Vzc1Rva2VuLFxuICAgICAgcmVmcmVzaFRva2VuOiB0b2tlbnMucmVmcmVzaFRva2VuXG4gICAgfSk7XG5cbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdMb2dpbiBlcnJvcjonLCBlcnJvcik7XG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgZXJyb3I6IEVSUk9SX01FU1NBR0VTLklOVEVSTkFMX0VSUk9SXG4gICAgfSwgeyBzdGF0dXM6IDUwMCB9KTtcbiAgfVxufVxuXG4vLyBIYW5kbGUgdXNlciByZWdpc3RyYXRpb25cbmFzeW5jIGZ1bmN0aW9uIGhhbmRsZVJlZ2lzdGVyKGRhdGE6IHtcbiAgZW1haWw6IHN0cmluZztcbiAgcGFzc3dvcmQ6IHN0cmluZztcbiAgbmFtZTogc3RyaW5nO1xuICByZXN0YXVyYW50TmFtZTogc3RyaW5nO1xuICBjdWlzaW5lVHlwZT86IHN0cmluZztcbiAgbG9jYXRpb24/OiBzdHJpbmc7XG4gIHBob25lPzogc3RyaW5nO1xuICBtYXJrZXRpbmdDb25zZW50PzogYm9vbGVhbjtcbn0pIHtcbiAgdHJ5IHtcbiAgICBjb25zdCBlbWFpbCA9IHNhbml0aXplRW1haWwoZGF0YS5lbWFpbCk7XG5cbiAgICAvLyBDaGVjayBpZiB1c2VyIGFscmVhZHkgZXhpc3RzXG4gICAgY29uc3QgZXhpc3RpbmdVc2VyID0gZGF0YWJhc2UuZ2V0VXNlckJ5RW1haWwoZW1haWwpO1xuICAgIGlmIChleGlzdGluZ1VzZXIpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBlcnJvcjogRVJST1JfTUVTU0FHRVMuVVNFUl9FWElTVFMsXG4gICAgICAgIG1lc3NhZ2U6ICdBbiBhY2NvdW50IHdpdGggdGhpcyBlbWFpbCBhbHJlYWR5IGV4aXN0cydcbiAgICAgIH0sIHsgc3RhdHVzOiA0MDkgfSk7XG4gICAgfVxuXG4gICAgLy8gSGFzaCBwYXNzd29yZFxuICAgIGNvbnN0IHBhc3N3b3JkSGFzaCA9IGF3YWl0IGF1dGhTZXJ2aWNlLmhhc2hQYXNzd29yZChkYXRhLnBhc3N3b3JkKTtcblxuICAgIC8vIENyZWF0ZSBTdHJpcGUgY3VzdG9tZXJcbiAgICBsZXQgc3RyaXBlQ3VzdG9tZXJJZDogc3RyaW5nIHwgdW5kZWZpbmVkO1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBzdHJpcGVDdXN0b21lciA9IGF3YWl0IHN0cmlwZS5jdXN0b21lcnMuY3JlYXRlKHtcbiAgICAgICAgZW1haWwsXG4gICAgICAgIG5hbWU6IGRhdGEubmFtZSxcbiAgICAgICAgbWV0YWRhdGE6IHtcbiAgICAgICAgICByZXN0YXVyYW50X25hbWU6IGRhdGEucmVzdGF1cmFudE5hbWUsXG4gICAgICAgICAgY3Vpc2luZV90eXBlOiBkYXRhLmN1aXNpbmVUeXBlIHx8ICcnLFxuICAgICAgICAgIGxvY2F0aW9uOiBkYXRhLmxvY2F0aW9uIHx8ICcnLFxuICAgICAgICAgIHBob25lOiBkYXRhLnBob25lIHx8ICcnLFxuICAgICAgICAgIHNvdXJjZTogJ2NoZWZzb2NpYWxfcmVnaXN0cmF0aW9uJyxcbiAgICAgICAgICBtYXJrZXRpbmdfY29uc2VudDogZGF0YS5tYXJrZXRpbmdDb25zZW50Py50b1N0cmluZygpIHx8ICdmYWxzZSdcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICBzdHJpcGVDdXN0b21lcklkID0gc3RyaXBlQ3VzdG9tZXIuaWQ7XG4gICAgfSBjYXRjaCAoc3RyaXBlRXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ1N0cmlwZSBjdXN0b21lciBjcmVhdGlvbiBmYWlsZWQ6Jywgc3RyaXBlRXJyb3IpO1xuICAgICAgLy8gQ29udGludWUgd2l0aCByZWdpc3RyYXRpb24gZXZlbiBpZiBTdHJpcGUgZmFpbHNcbiAgICB9XG5cbiAgICAvLyBQcmVwYXJlIHVzZXIgZGF0YVxuICAgIGNvbnN0IHRyaWFsU3RhcnREYXRlID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpO1xuICAgIGNvbnN0IHRyaWFsRW5kRGF0ZSA9IG5ldyBEYXRlKERhdGUubm93KCkgKyAxNCAqIDI0ICogNjAgKiA2MCAqIDEwMDApLnRvSVNPU3RyaW5nKCk7XG5cbiAgICBjb25zdCB1c2VyRGF0YSA9IHtcbiAgICAgIGVtYWlsLFxuICAgICAgcGFzc3dvcmRIYXNoLFxuICAgICAgbmFtZTogZGF0YS5uYW1lLFxuICAgICAgcmVzdGF1cmFudE5hbWU6IGRhdGEucmVzdGF1cmFudE5hbWUsXG4gICAgICBjdWlzaW5lVHlwZTogZGF0YS5jdWlzaW5lVHlwZSxcbiAgICAgIGxvY2F0aW9uOiBkYXRhLmxvY2F0aW9uLFxuICAgICAgcGhvbmU6IGRhdGEucGhvbmUsXG4gICAgICByb2xlOiAndXNlcicgYXMgY29uc3QsXG4gICAgICBzdWJzY3JpcHRpb25TdGF0dXM6ICd0cmlhbGluZycgYXMgY29uc3QsXG4gICAgICB0cmlhbFN0YXJ0RGF0ZSxcbiAgICAgIHRyaWFsRW5kRGF0ZSxcbiAgICAgIHN0cmlwZUN1c3RvbWVySWQsXG4gICAgICBzdHJpcGVTdWJzY3JpcHRpb25JZDogdW5kZWZpbmVkLFxuICAgICAgbWFya2V0aW5nQ29uc2VudDogZGF0YS5tYXJrZXRpbmdDb25zZW50IHx8IGZhbHNlLFxuICAgICAgZW1haWxWZXJpZmllZDogZmFsc2UsXG4gICAgICBvbmJvYXJkaW5nQ29tcGxldGVkOiBmYWxzZVxuICAgIH07XG5cbiAgICAvLyBDcmVhdGUgdXNlciBpbiBkYXRhYmFzZVxuICAgIGNvbnN0IG5ld1VzZXIgPSBhd2FpdCBkYXRhYmFzZS5jcmVhdGVVc2VyKHVzZXJEYXRhKTtcblxuICAgIC8vIENyZWF0ZSBhdXRoIHRva2Vuc1xuICAgIGNvbnN0IHRva2VucyA9IGF1dGhTZXJ2aWNlLmNyZWF0ZUF1dGhUb2tlbnMobmV3VXNlcik7XG5cbiAgICAvLyBSZXR1cm4gc3VjY2VzcyByZXNwb25zZVxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgbWVzc2FnZTogJ1JlZ2lzdHJhdGlvbiBzdWNjZXNzZnVsJyxcbiAgICAgIHVzZXI6IGF1dGhTZXJ2aWNlLnRvUHVibGljVXNlcihuZXdVc2VyKSxcbiAgICAgIGFjY2Vzc1Rva2VuOiB0b2tlbnMuYWNjZXNzVG9rZW4sXG4gICAgICByZWZyZXNoVG9rZW46IHRva2Vucy5yZWZyZXNoVG9rZW5cbiAgICB9LCB7IHN0YXR1czogMjAxIH0pO1xuXG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignUmVnaXN0cmF0aW9uIGVycm9yOicsIGVycm9yKTtcbiAgICBcbiAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBFcnJvciAmJiBlcnJvci5tZXNzYWdlLmluY2x1ZGVzKCdhbHJlYWR5IGV4aXN0cycpKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6IEVSUk9SX01FU1NBR0VTLlVTRVJfRVhJU1RTLFxuICAgICAgICBtZXNzYWdlOiAnQW4gYWNjb3VudCB3aXRoIHRoaXMgZW1haWwgYWxyZWFkeSBleGlzdHMnXG4gICAgICB9LCB7IHN0YXR1czogNDA5IH0pO1xuICAgIH1cblxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgIGVycm9yOiBFUlJPUl9NRVNTQUdFUy5JTlRFUk5BTF9FUlJPUlxuICAgIH0sIHsgc3RhdHVzOiA1MDAgfSk7XG4gIH1cbn1cblxuLy8gSGFuZGxlIHRva2VuIHJlZnJlc2hcbmFzeW5jIGZ1bmN0aW9uIGhhbmRsZVRva2VuUmVmcmVzaChib2R5OiBhbnkpIHtcbiAgdHJ5IHtcbiAgICAvLyBWYWxpZGF0ZSByZWZyZXNoIHRva2VuIHJlcXVlc3RcbiAgICBjb25zdCB2YWxpZGF0aW9uID0gdmFsaWRhdGVJbnB1dChyZWZyZXNoVG9rZW5SZXF1ZXN0U2NoZW1hLCBib2R5KTtcbiAgICBpZiAoIXZhbGlkYXRpb24uc3VjY2Vzcykge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIGVycm9yOiAnSW52YWxpZCByZWZyZXNoIHRva2VuIGZvcm1hdCcsXG4gICAgICAgIGRldGFpbHM6IHZhbGlkYXRpb24uZXJyb3JzXG4gICAgICB9LCB7IHN0YXR1czogNDAwIH0pO1xuICAgIH1cblxuICAgIGNvbnN0IHsgcmVmcmVzaFRva2VuIH0gPSB2YWxpZGF0aW9uLmRhdGEhO1xuXG4gICAgLy8gUmVmcmVzaCB0aGUgYWNjZXNzIHRva2VuXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYXV0aFNlcnZpY2UucmVmcmVzaEFjY2Vzc1Rva2VuKHJlZnJlc2hUb2tlbik7XG5cbiAgICBpZiAoIXJlc3VsdC5zdWNjZXNzKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6IHJlc3VsdC5lcnJvciB8fCAnVG9rZW4gcmVmcmVzaCBmYWlsZWQnXG4gICAgICB9LCB7IHN0YXR1czogNDAxIH0pO1xuICAgIH1cblxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgbWVzc2FnZTogJ1Rva2VuIHJlZnJlc2hlZCBzdWNjZXNzZnVsbHknLFxuICAgICAgYWNjZXNzVG9rZW46IHJlc3VsdC5hY2Nlc3NUb2tlbixcbiAgICAgIHJlZnJlc2hUb2tlbjogcmVzdWx0LnJlZnJlc2hUb2tlblxuICAgIH0pO1xuXG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignVG9rZW4gcmVmcmVzaCBlcnJvcjonLCBlcnJvcik7XG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgZXJyb3I6ICdUb2tlbiByZWZyZXNoIGZhaWxlZCdcbiAgICB9LCB7IHN0YXR1czogNTAwIH0pO1xuICB9XG59XG5cbi8vIFBPU1QgL2FwaS9hdXRoL2xvZ291dCAtIEhhbmRsZSBsb2dvdXQgKHJldm9rZSByZWZyZXNoIHRva2VuKVxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIERFTEVURShyZXF1ZXN0OiBOZXh0UmVxdWVzdCkge1xuICB0cnkge1xuICAgIGNvbnN0IGJvZHkgPSBhd2FpdCByZXF1ZXN0Lmpzb24oKTtcbiAgICBjb25zdCB7IHJlZnJlc2hUb2tlbiwgbG9nb3V0QWxsID0gZmFsc2UgfSA9IGJvZHk7XG5cbiAgICBpZiAobG9nb3V0QWxsKSB7XG4gICAgICAvLyBMb2dvdXQgZnJvbSBhbGwgZGV2aWNlcyAtIG5lZWQgdXNlciBJRFxuICAgICAgY29uc3QgdXNlciA9IGF3YWl0IGF1dGhTZXJ2aWNlLmdldFVzZXJGcm9tUmVxdWVzdChyZXF1ZXN0KTtcbiAgICAgIGlmICh1c2VyKSB7XG4gICAgICAgIGF1dGhTZXJ2aWNlLnJldm9rZUFsbFVzZXJUb2tlbnModXNlci5pZCk7XG4gICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgICBtZXNzYWdlOiAnTG9nZ2VkIG91dCBmcm9tIGFsbCBkZXZpY2VzJ1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKHJlZnJlc2hUb2tlbikge1xuICAgICAgLy8gTG9nb3V0IGZyb20gY3VycmVudCBkZXZpY2VcbiAgICAgIGNvbnN0IHN1Y2Nlc3MgPSBhdXRoU2VydmljZS5yZXZva2VSZWZyZXNoVG9rZW4ocmVmcmVzaFRva2VuKTtcbiAgICAgIGlmIChzdWNjZXNzKSB7XG4gICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgICBtZXNzYWdlOiAnTG9nb3V0IHN1Y2Nlc3NmdWwnXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgIGVycm9yOiAnTG9nb3V0IGZhaWxlZCdcbiAgICB9LCB7IHN0YXR1czogNDAwIH0pO1xuXG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignTG9nb3V0IGVycm9yOicsIGVycm9yKTtcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xuICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICBlcnJvcjogJ0xvZ291dCBmYWlsZWQnXG4gICAgfSwgeyBzdGF0dXM6IDUwMCB9KTtcbiAgfVxufVxuXG4vLyBHRVQgL2FwaS9hdXRoL21lIC0gR2V0IGN1cnJlbnQgdXNlciBpbmZvXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gR0VUKHJlcXVlc3Q6IE5leHRSZXF1ZXN0KSB7XG4gIHRyeSB7XG4gICAgY29uc3QgdXNlciA9IGF3YWl0IGF1dGhTZXJ2aWNlLmdldFVzZXJGcm9tUmVxdWVzdChyZXF1ZXN0KTtcbiAgICBcbiAgICBpZiAoIXVzZXIpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBlcnJvcjogJ05vdCBhdXRoZW50aWNhdGVkJ1xuICAgICAgfSwgeyBzdGF0dXM6IDQwMSB9KTtcbiAgICB9XG5cbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xuICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIHVzZXI6IGF1dGhTZXJ2aWNlLnRvUHVibGljVXNlcih1c2VyKVxuICAgIH0pO1xuXG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignR2V0IHVzZXIgZXJyb3I6JywgZXJyb3IpO1xuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgIGVycm9yOiBFUlJPUl9NRVNTQUdFUy5JTlRFUk5BTF9FUlJPUlxuICAgIH0sIHsgc3RhdHVzOiA1MDAgfSk7XG4gIH1cbn0gIl0sIm5hbWVzIjpbIk5leHRSZXNwb25zZSIsIlN0cmlwZSIsImRhdGFiYXNlIiwiYXV0aFNlcnZpY2UiLCJ2YWxpZGF0ZUlucHV0IiwiYXV0aFJlcXVlc3RTY2hlbWEiLCJyZWZyZXNoVG9rZW5SZXF1ZXN0U2NoZW1hIiwic2FuaXRpemVFbWFpbCIsIkVSUk9SX01FU1NBR0VTIiwic3RyaXBlIiwicHJvY2VzcyIsImVudiIsIlNUUklQRV9TRUNSRVRfS0VZIiwiYXBpVmVyc2lvbiIsIlBPU1QiLCJyZXF1ZXN0IiwiYm9keSIsImpzb24iLCJhY3Rpb24iLCJoYW5kbGVUb2tlblJlZnJlc2giLCJ2YWxpZGF0aW9uIiwic3VjY2VzcyIsImVycm9yIiwiZGV0YWlscyIsImVycm9ycyIsInN0YXR1cyIsInZhbGlkYXRlZERhdGEiLCJkYXRhIiwiaGFuZGxlTG9naW4iLCJoYW5kbGVSZWdpc3RlciIsImNvbnNvbGUiLCJJTlRFUk5BTF9FUlJPUiIsImVtYWlsIiwidXNlciIsImdldFVzZXJCeUVtYWlsIiwiSU5WQUxJRF9DUkVERU5USUFMUyIsIm1lc3NhZ2UiLCJpc1ZhbGlkUGFzc3dvcmQiLCJ2ZXJpZnlQYXNzd29yZCIsInBhc3N3b3JkIiwicGFzc3dvcmRIYXNoIiwidXBkYXRlTGFzdExvZ2luIiwiaWQiLCJ0b2tlbnMiLCJjcmVhdGVBdXRoVG9rZW5zIiwidG9QdWJsaWNVc2VyIiwiYWNjZXNzVG9rZW4iLCJyZWZyZXNoVG9rZW4iLCJleGlzdGluZ1VzZXIiLCJVU0VSX0VYSVNUUyIsImhhc2hQYXNzd29yZCIsInN0cmlwZUN1c3RvbWVySWQiLCJzdHJpcGVDdXN0b21lciIsImN1c3RvbWVycyIsImNyZWF0ZSIsIm5hbWUiLCJtZXRhZGF0YSIsInJlc3RhdXJhbnRfbmFtZSIsInJlc3RhdXJhbnROYW1lIiwiY3Vpc2luZV90eXBlIiwiY3Vpc2luZVR5cGUiLCJsb2NhdGlvbiIsInBob25lIiwic291cmNlIiwibWFya2V0aW5nX2NvbnNlbnQiLCJtYXJrZXRpbmdDb25zZW50IiwidG9TdHJpbmciLCJzdHJpcGVFcnJvciIsInRyaWFsU3RhcnREYXRlIiwiRGF0ZSIsInRvSVNPU3RyaW5nIiwidHJpYWxFbmREYXRlIiwibm93IiwidXNlckRhdGEiLCJyb2xlIiwic3Vic2NyaXB0aW9uU3RhdHVzIiwic3RyaXBlU3Vic2NyaXB0aW9uSWQiLCJ1bmRlZmluZWQiLCJlbWFpbFZlcmlmaWVkIiwib25ib2FyZGluZ0NvbXBsZXRlZCIsIm5ld1VzZXIiLCJjcmVhdGVVc2VyIiwiRXJyb3IiLCJpbmNsdWRlcyIsInJlc3VsdCIsInJlZnJlc2hBY2Nlc3NUb2tlbiIsIkRFTEVURSIsImxvZ291dEFsbCIsImdldFVzZXJGcm9tUmVxdWVzdCIsInJldm9rZUFsbFVzZXJUb2tlbnMiLCJyZXZva2VSZWZyZXNoVG9rZW4iLCJHRVQiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/app/api/auth/route.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/auth.ts":
/*!*************************!*\
  !*** ./src/lib/auth.ts ***!
  \*************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   AuthService: () => (/* binding */ AuthService),\n/* harmony export */   authService: () => (/* binding */ authService),\n/* harmony export */   requireAuth: () => (/* binding */ requireAuth),\n/* harmony export */   requireRole: () => (/* binding */ requireRole)\n/* harmony export */ });\n/* harmony import */ var jsonwebtoken__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jsonwebtoken */ \"(rsc)/./node_modules/jsonwebtoken/index.js\");\n/* harmony import */ var jsonwebtoken__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jsonwebtoken__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var bcryptjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! bcryptjs */ \"(rsc)/./node_modules/bcryptjs/index.js\");\n/* harmony import */ var bcryptjs__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(bcryptjs__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! crypto */ \"crypto\");\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(crypto__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _lib_database__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/lib/database */ \"(rsc)/./src/lib/database.ts\");\n\n\n\n\n// JWT Configuration\nconst JWT_SECRET = process.env.JWT_SECRET || \"dev-jwt-secret-key\";\nconst JWT_REFRESH_SECRET = process.env.JWT_REFRESH_SECRET || \"dev-refresh-secret-key\";\nconst ACCESS_TOKEN_EXPIRY = \"15m\"; // 15 minutes\nconst REFRESH_TOKEN_EXPIRY = \"7d\"; // 7 days\nclass AuthService {\n    // Generate JWT access token\n    generateAccessToken(payload) {\n        return jsonwebtoken__WEBPACK_IMPORTED_MODULE_0___default().sign(payload, JWT_SECRET, {\n            expiresIn: ACCESS_TOKEN_EXPIRY,\n            issuer: \"chefsocial-api\",\n            audience: \"chefsocial-app\"\n        });\n    }\n    // Generate refresh token\n    generateRefreshToken(userId) {\n        const token = crypto__WEBPACK_IMPORTED_MODULE_2___default().randomBytes(64).toString(\"hex\");\n        const tokenHash = crypto__WEBPACK_IMPORTED_MODULE_2___default().createHash(\"sha256\").update(token).digest(\"hex\");\n        const expiresAt = new Date(Date.now() + 7 * 24 * 60 * 60 * 1000); // 7 days\n        // Store in database\n        _lib_database__WEBPACK_IMPORTED_MODULE_3__.database.createRefreshToken(userId, tokenHash, expiresAt);\n        return {\n            token,\n            tokenHash,\n            expiresAt\n        };\n    }\n    // Verify JWT access token\n    verifyAccessToken(token) {\n        try {\n            const decoded = jsonwebtoken__WEBPACK_IMPORTED_MODULE_0___default().verify(token, JWT_SECRET, {\n                issuer: \"chefsocial-api\",\n                audience: \"chefsocial-app\"\n            });\n            return decoded;\n        } catch (error) {\n            console.error(\"Access token verification failed:\", error);\n            return null;\n        }\n    }\n    // Verify refresh token\n    async verifyRefreshToken(token) {\n        try {\n            const tokenHash = crypto__WEBPACK_IMPORTED_MODULE_2___default().createHash(\"sha256\").update(token).digest(\"hex\");\n            const refreshToken = _lib_database__WEBPACK_IMPORTED_MODULE_3__.database.getRefreshToken(tokenHash);\n            if (!refreshToken) {\n                return null;\n            }\n            // Check if token is expired\n            if (refreshToken.expiresAt < new Date()) {\n                _lib_database__WEBPACK_IMPORTED_MODULE_3__.database.revokeRefreshToken(tokenHash);\n                return null;\n            }\n            return refreshToken;\n        } catch (error) {\n            console.error(\"Refresh token verification failed:\", error);\n            return null;\n        }\n    }\n    // Hash password\n    async hashPassword(password) {\n        const saltRounds = 12;\n        return bcryptjs__WEBPACK_IMPORTED_MODULE_1___default().hash(password, saltRounds);\n    }\n    // Verify password\n    async verifyPassword(password, hashedPassword) {\n        return bcryptjs__WEBPACK_IMPORTED_MODULE_1___default().compare(password, hashedPassword);\n    }\n    // Extract user from request\n    async getUserFromRequest(request) {\n        const token = this.extractTokenFromRequest(request);\n        if (!token) return null;\n        const payload = this.verifyAccessToken(token);\n        if (!payload) return null;\n        return _lib_database__WEBPACK_IMPORTED_MODULE_3__.database.getUserById(payload.userId);\n    }\n    // Extract token from request headers\n    extractTokenFromRequest(request) {\n        const authHeader = request.headers.get(\"authorization\");\n        if (!authHeader) return null;\n        const parts = authHeader.split(\" \");\n        if (parts.length !== 2 || parts[0] !== \"Bearer\") return null;\n        return parts[1];\n    }\n    // Create auth tokens for user\n    createAuthTokens(user) {\n        const payload = {\n            userId: user.id,\n            email: user.email,\n            role: user.role\n        };\n        const accessToken = this.generateAccessToken(payload);\n        const { token: refreshToken } = this.generateRefreshToken(user.id);\n        return {\n            accessToken,\n            refreshToken\n        };\n    }\n    // Refresh access token using refresh token\n    async refreshAccessToken(refreshToken) {\n        try {\n            const tokenData = await this.verifyRefreshToken(refreshToken);\n            if (!tokenData) {\n                return {\n                    success: false,\n                    error: \"Invalid or expired refresh token\"\n                };\n            }\n            const user = _lib_database__WEBPACK_IMPORTED_MODULE_3__.database.getUserById(tokenData.userId);\n            if (!user) {\n                _lib_database__WEBPACK_IMPORTED_MODULE_3__.database.revokeRefreshToken(tokenData.tokenHash);\n                return {\n                    success: false,\n                    error: \"User not found\"\n                };\n            }\n            // Revoke old refresh token\n            _lib_database__WEBPACK_IMPORTED_MODULE_3__.database.revokeRefreshToken(tokenData.tokenHash);\n            // Create new tokens\n            const tokens = this.createAuthTokens(user);\n            return {\n                success: true,\n                accessToken: tokens.accessToken,\n                refreshToken: tokens.refreshToken\n            };\n        } catch (error) {\n            console.error(\"Token refresh failed:\", error);\n            return {\n                success: false,\n                error: \"Token refresh failed\"\n            };\n        }\n    }\n    // Revoke all user tokens (logout from all devices)\n    revokeAllUserTokens(userId) {\n        _lib_database__WEBPACK_IMPORTED_MODULE_3__.database.revokeAllUserRefreshTokens(userId);\n    }\n    // Revoke specific refresh token (logout from specific device)\n    revokeRefreshToken(refreshToken) {\n        try {\n            const tokenHash = crypto__WEBPACK_IMPORTED_MODULE_2___default().createHash(\"sha256\").update(refreshToken).digest(\"hex\");\n            _lib_database__WEBPACK_IMPORTED_MODULE_3__.database.revokeRefreshToken(tokenHash);\n            return true;\n        } catch (error) {\n            console.error(\"Token revocation failed:\", error);\n            return false;\n        }\n    }\n    // Convert User to PublicUser (remove sensitive data)\n    toPublicUser(user) {\n        return {\n            id: user.id,\n            email: user.email,\n            name: user.name,\n            restaurantName: user.restaurantName,\n            cuisineType: user.cuisineType,\n            location: user.location,\n            phone: user.phone,\n            role: user.role,\n            subscriptionStatus: user.subscriptionStatus,\n            trialEndDate: user.trialEndDate,\n            stripeCustomerId: user.stripeCustomerId,\n            emailVerified: user.emailVerified,\n            onboardingCompleted: user.onboardingCompleted,\n            createdAt: user.createdAt,\n            lastLoginAt: user.lastLoginAt\n        };\n    }\n    // Clean up expired tokens (should be run periodically)\n    cleanup() {\n        _lib_database__WEBPACK_IMPORTED_MODULE_3__.database.cleanupExpiredTokens();\n    }\n    // Check if user has required role\n    hasRole(user, requiredRole) {\n        const roles = Array.isArray(requiredRole) ? requiredRole : [\n            requiredRole\n        ];\n        return roles.includes(user.role);\n    }\n    // Check if user is admin\n    isAdmin(user) {\n        return user.role === \"admin\";\n    }\n    // Check if user can access resource\n    canAccessResource(user, resourceUserId) {\n        // Users can access their own resources, admins can access all\n        return user.id === resourceUserId || this.isAdmin(user);\n    }\n    // Rate limiting helper\n    getRateLimitKey(identifier, action) {\n        return `ratelimit:${action}:${identifier}`;\n    }\n    // Generate secure random token\n    generateSecureToken(length = 32) {\n        return crypto__WEBPACK_IMPORTED_MODULE_2___default().randomBytes(length).toString(\"hex\");\n    }\n    // Validate token format\n    isValidTokenFormat(token) {\n        // Check if token looks like a JWT (has 3 parts separated by dots)\n        const parts = token.split(\".\");\n        return parts.length === 3 && parts.every((part)=>part.length > 0);\n    }\n    // Create password reset token\n    createPasswordResetToken(userId) {\n        const token = this.generateSecureToken(32);\n        const expiresAt = new Date(Date.now() + 60 * 60 * 1000); // 1 hour\n        // In a real app, you'd store this in a separate table\n        // For now, we'll use a simple in-memory store or database\n        return {\n            token,\n            expiresAt\n        };\n    }\n    // Create email verification token\n    createEmailVerificationToken(userId) {\n        const token = this.generateSecureToken(32);\n        const expiresAt = new Date(Date.now() + 24 * 60 * 60 * 1000); // 24 hours\n        return {\n            token,\n            expiresAt\n        };\n    }\n}\n// Singleton instance\nconst authService = new AuthService();\n// Middleware helper functions\nfunction requireAuth(handler) {\n    return async (request)=>{\n        try {\n            const user = await authService.getUserFromRequest(request);\n            if (!user) {\n                return new Response(JSON.stringify({\n                    success: false,\n                    error: \"Authentication required\"\n                }), {\n                    status: 401,\n                    headers: {\n                        \"Content-Type\": \"application/json\"\n                    }\n                });\n            }\n            return handler(request, user);\n        } catch (error) {\n            console.error(\"Auth middleware error:\", error);\n            return new Response(JSON.stringify({\n                success: false,\n                error: \"Authentication failed\"\n            }), {\n                status: 401,\n                headers: {\n                    \"Content-Type\": \"application/json\"\n                }\n            });\n        }\n    };\n}\nfunction requireRole(roles) {\n    return function(handler) {\n        return async (request)=>{\n            try {\n                const user = await authService.getUserFromRequest(request);\n                if (!user) {\n                    return new Response(JSON.stringify({\n                        success: false,\n                        error: \"Authentication required\"\n                    }), {\n                        status: 401,\n                        headers: {\n                            \"Content-Type\": \"application/json\"\n                        }\n                    });\n                }\n                if (!authService.hasRole(user, roles)) {\n                    return new Response(JSON.stringify({\n                        success: false,\n                        error: \"Insufficient permissions\"\n                    }), {\n                        status: 403,\n                        headers: {\n                            \"Content-Type\": \"application/json\"\n                        }\n                    });\n                }\n                return handler(request, user);\n            } catch (error) {\n                console.error(\"Role middleware error:\", error);\n                return new Response(JSON.stringify({\n                    success: false,\n                    error: \"Authorization failed\"\n                }), {\n                    status: 403,\n                    headers: {\n                        \"Content-Type\": \"application/json\"\n                    }\n                });\n            }\n        };\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Q0Y7QUFFTyxTQUFTeUQsWUFBWXZCLEtBQXdCO0lBQ2xELE9BQU8sU0FBU2tCLE9BQWdFO1FBQzlFLE9BQU8sT0FBT3hEO1lBQ1osSUFBSTtnQkFDRixNQUFNVSxPQUFPLE1BQU00QyxZQUFZdkQsa0JBQWtCLENBQUNDO2dCQUVsRCxJQUFJLENBQUNVLE1BQU07b0JBQ1QsT0FBTyxJQUFJK0MsU0FDVEMsS0FBS0MsU0FBUyxDQUFDO3dCQUFFMUMsU0FBUzt3QkFBTy9CLE9BQU87b0JBQTBCLElBQ2xFO3dCQUFFMEUsUUFBUTt3QkFBS3hELFNBQVM7NEJBQUUsZ0JBQWdCO3dCQUFtQjtvQkFBRTtnQkFFbkU7Z0JBRUEsSUFBSSxDQUFDa0QsWUFBWWxCLE9BQU8sQ0FBQzFCLE1BQU00QixRQUFRO29CQUNyQyxPQUFPLElBQUltQixTQUNUQyxLQUFLQyxTQUFTLENBQUM7d0JBQUUxQyxTQUFTO3dCQUFPL0IsT0FBTztvQkFBMkIsSUFDbkU7d0JBQUUwRSxRQUFRO3dCQUFLeEQsU0FBUzs0QkFBRSxnQkFBZ0I7d0JBQW1CO29CQUFFO2dCQUVuRTtnQkFFQSxPQUFPb0QsUUFBUXhELFNBQVNVO1lBQzFCLEVBQUUsT0FBT3hCLE9BQU87Z0JBQ2RDLFFBQVFELEtBQUssQ0FBQywwQkFBMEJBO2dCQUN4QyxPQUFPLElBQUl1RSxTQUNUQyxLQUFLQyxTQUFTLENBQUM7b0JBQUUxQyxTQUFTO29CQUFPL0IsT0FBTztnQkFBdUIsSUFDL0Q7b0JBQUUwRSxRQUFRO29CQUFLeEQsU0FBUzt3QkFBRSxnQkFBZ0I7b0JBQW1CO2dCQUFFO1lBRW5FO1FBQ0Y7SUFDRjtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vY2hlZnNvY2lhbC1uZXh0Ly4vc3JjL2xpYi9hdXRoLnRzPzY2OTIiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGp3dCBmcm9tICdqc29ud2VidG9rZW4nO1xuaW1wb3J0IGJjcnlwdCBmcm9tICdiY3J5cHRqcyc7XG5pbXBvcnQgY3J5cHRvIGZyb20gJ2NyeXB0byc7XG5pbXBvcnQgeyBOZXh0UmVxdWVzdCB9IGZyb20gJ25leHQvc2VydmVyJztcbmltcG9ydCB7IEpXVFBheWxvYWQsIFVzZXIsIFB1YmxpY1VzZXIsIFJlZnJlc2hUb2tlbiB9IGZyb20gJ0AvdHlwZXMvYXV0aCc7XG5pbXBvcnQgeyBkYXRhYmFzZSB9IGZyb20gJ0AvbGliL2RhdGFiYXNlJztcblxuLy8gSldUIENvbmZpZ3VyYXRpb25cbmNvbnN0IEpXVF9TRUNSRVQgPSBwcm9jZXNzLmVudi5KV1RfU0VDUkVUIHx8ICdkZXYtand0LXNlY3JldC1rZXknO1xuY29uc3QgSldUX1JFRlJFU0hfU0VDUkVUID0gcHJvY2Vzcy5lbnYuSldUX1JFRlJFU0hfU0VDUkVUIHx8ICdkZXYtcmVmcmVzaC1zZWNyZXQta2V5JztcbmNvbnN0IEFDQ0VTU19UT0tFTl9FWFBJUlkgPSAnMTVtJzsgLy8gMTUgbWludXRlc1xuY29uc3QgUkVGUkVTSF9UT0tFTl9FWFBJUlkgPSAnN2QnOyAvLyA3IGRheXNcblxuZXhwb3J0IGNsYXNzIEF1dGhTZXJ2aWNlIHtcbiAgLy8gR2VuZXJhdGUgSldUIGFjY2VzcyB0b2tlblxuICBnZW5lcmF0ZUFjY2Vzc1Rva2VuKHBheWxvYWQ6IEpXVFBheWxvYWQpOiBzdHJpbmcge1xuICAgIHJldHVybiBqd3Quc2lnbihwYXlsb2FkLCBKV1RfU0VDUkVULCB7IFxuICAgICAgZXhwaXJlc0luOiBBQ0NFU1NfVE9LRU5fRVhQSVJZLFxuICAgICAgaXNzdWVyOiAnY2hlZnNvY2lhbC1hcGknLFxuICAgICAgYXVkaWVuY2U6ICdjaGVmc29jaWFsLWFwcCdcbiAgICB9KTtcbiAgfVxuXG4gIC8vIEdlbmVyYXRlIHJlZnJlc2ggdG9rZW5cbiAgZ2VuZXJhdGVSZWZyZXNoVG9rZW4odXNlcklkOiBzdHJpbmcpOiB7IHRva2VuOiBzdHJpbmc7IHRva2VuSGFzaDogc3RyaW5nOyBleHBpcmVzQXQ6IERhdGUgfSB7XG4gICAgY29uc3QgdG9rZW4gPSBjcnlwdG8ucmFuZG9tQnl0ZXMoNjQpLnRvU3RyaW5nKCdoZXgnKTtcbiAgICBjb25zdCB0b2tlbkhhc2ggPSBjcnlwdG8uY3JlYXRlSGFzaCgnc2hhMjU2JykudXBkYXRlKHRva2VuKS5kaWdlc3QoJ2hleCcpO1xuICAgIGNvbnN0IGV4cGlyZXNBdCA9IG5ldyBEYXRlKERhdGUubm93KCkgKyA3ICogMjQgKiA2MCAqIDYwICogMTAwMCk7IC8vIDcgZGF5c1xuXG4gICAgLy8gU3RvcmUgaW4gZGF0YWJhc2VcbiAgICBkYXRhYmFzZS5jcmVhdGVSZWZyZXNoVG9rZW4odXNlcklkLCB0b2tlbkhhc2gsIGV4cGlyZXNBdCk7XG5cbiAgICByZXR1cm4geyB0b2tlbiwgdG9rZW5IYXNoLCBleHBpcmVzQXQgfTtcbiAgfVxuXG4gIC8vIFZlcmlmeSBKV1QgYWNjZXNzIHRva2VuXG4gIHZlcmlmeUFjY2Vzc1Rva2VuKHRva2VuOiBzdHJpbmcpOiBKV1RQYXlsb2FkIHwgbnVsbCB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGRlY29kZWQgPSBqd3QudmVyaWZ5KHRva2VuLCBKV1RfU0VDUkVULCB7XG4gICAgICAgIGlzc3VlcjogJ2NoZWZzb2NpYWwtYXBpJyxcbiAgICAgICAgYXVkaWVuY2U6ICdjaGVmc29jaWFsLWFwcCdcbiAgICAgIH0pIGFzIEpXVFBheWxvYWQ7XG4gICAgICBcbiAgICAgIHJldHVybiBkZWNvZGVkO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdBY2Nlc3MgdG9rZW4gdmVyaWZpY2F0aW9uIGZhaWxlZDonLCBlcnJvcik7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gIH1cblxuICAvLyBWZXJpZnkgcmVmcmVzaCB0b2tlblxuICBhc3luYyB2ZXJpZnlSZWZyZXNoVG9rZW4odG9rZW46IHN0cmluZyk6IFByb21pc2U8UmVmcmVzaFRva2VuIHwgbnVsbD4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB0b2tlbkhhc2ggPSBjcnlwdG8uY3JlYXRlSGFzaCgnc2hhMjU2JykudXBkYXRlKHRva2VuKS5kaWdlc3QoJ2hleCcpO1xuICAgICAgY29uc3QgcmVmcmVzaFRva2VuID0gZGF0YWJhc2UuZ2V0UmVmcmVzaFRva2VuKHRva2VuSGFzaCk7XG4gICAgICBcbiAgICAgIGlmICghcmVmcmVzaFRva2VuKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfVxuXG4gICAgICAvLyBDaGVjayBpZiB0b2tlbiBpcyBleHBpcmVkXG4gICAgICBpZiAocmVmcmVzaFRva2VuLmV4cGlyZXNBdCA8IG5ldyBEYXRlKCkpIHtcbiAgICAgICAgZGF0YWJhc2UucmV2b2tlUmVmcmVzaFRva2VuKHRva2VuSGFzaCk7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gcmVmcmVzaFRva2VuO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdSZWZyZXNoIHRva2VuIHZlcmlmaWNhdGlvbiBmYWlsZWQ6JywgZXJyb3IpO1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICB9XG5cbiAgLy8gSGFzaCBwYXNzd29yZFxuICBhc3luYyBoYXNoUGFzc3dvcmQocGFzc3dvcmQ6IHN0cmluZyk6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgY29uc3Qgc2FsdFJvdW5kcyA9IDEyO1xuICAgIHJldHVybiBiY3J5cHQuaGFzaChwYXNzd29yZCwgc2FsdFJvdW5kcyk7XG4gIH1cblxuICAvLyBWZXJpZnkgcGFzc3dvcmRcbiAgYXN5bmMgdmVyaWZ5UGFzc3dvcmQocGFzc3dvcmQ6IHN0cmluZywgaGFzaGVkUGFzc3dvcmQ6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIHJldHVybiBiY3J5cHQuY29tcGFyZShwYXNzd29yZCwgaGFzaGVkUGFzc3dvcmQpO1xuICB9XG5cbiAgLy8gRXh0cmFjdCB1c2VyIGZyb20gcmVxdWVzdFxuICBhc3luYyBnZXRVc2VyRnJvbVJlcXVlc3QocmVxdWVzdDogTmV4dFJlcXVlc3QpOiBQcm9taXNlPFVzZXIgfCBudWxsPiB7XG4gICAgY29uc3QgdG9rZW4gPSB0aGlzLmV4dHJhY3RUb2tlbkZyb21SZXF1ZXN0KHJlcXVlc3QpO1xuICAgIGlmICghdG9rZW4pIHJldHVybiBudWxsO1xuXG4gICAgY29uc3QgcGF5bG9hZCA9IHRoaXMudmVyaWZ5QWNjZXNzVG9rZW4odG9rZW4pO1xuICAgIGlmICghcGF5bG9hZCkgcmV0dXJuIG51bGw7XG5cbiAgICByZXR1cm4gZGF0YWJhc2UuZ2V0VXNlckJ5SWQocGF5bG9hZC51c2VySWQpO1xuICB9XG5cbiAgLy8gRXh0cmFjdCB0b2tlbiBmcm9tIHJlcXVlc3QgaGVhZGVyc1xuICBwcml2YXRlIGV4dHJhY3RUb2tlbkZyb21SZXF1ZXN0KHJlcXVlc3Q6IE5leHRSZXF1ZXN0KTogc3RyaW5nIHwgbnVsbCB7XG4gICAgY29uc3QgYXV0aEhlYWRlciA9IHJlcXVlc3QuaGVhZGVycy5nZXQoJ2F1dGhvcml6YXRpb24nKTtcbiAgICBpZiAoIWF1dGhIZWFkZXIpIHJldHVybiBudWxsO1xuXG4gICAgY29uc3QgcGFydHMgPSBhdXRoSGVhZGVyLnNwbGl0KCcgJyk7XG4gICAgaWYgKHBhcnRzLmxlbmd0aCAhPT0gMiB8fCBwYXJ0c1swXSAhPT0gJ0JlYXJlcicpIHJldHVybiBudWxsO1xuXG4gICAgcmV0dXJuIHBhcnRzWzFdO1xuICB9XG5cbiAgLy8gQ3JlYXRlIGF1dGggdG9rZW5zIGZvciB1c2VyXG4gIGNyZWF0ZUF1dGhUb2tlbnModXNlcjogVXNlcik6IHsgYWNjZXNzVG9rZW46IHN0cmluZzsgcmVmcmVzaFRva2VuOiBzdHJpbmcgfSB7XG4gICAgY29uc3QgcGF5bG9hZDogSldUUGF5bG9hZCA9IHtcbiAgICAgIHVzZXJJZDogdXNlci5pZCxcbiAgICAgIGVtYWlsOiB1c2VyLmVtYWlsLFxuICAgICAgcm9sZTogdXNlci5yb2xlXG4gICAgfTtcblxuICAgIGNvbnN0IGFjY2Vzc1Rva2VuID0gdGhpcy5nZW5lcmF0ZUFjY2Vzc1Rva2VuKHBheWxvYWQpO1xuICAgIGNvbnN0IHsgdG9rZW46IHJlZnJlc2hUb2tlbiB9ID0gdGhpcy5nZW5lcmF0ZVJlZnJlc2hUb2tlbih1c2VyLmlkKTtcblxuICAgIHJldHVybiB7IGFjY2Vzc1Rva2VuLCByZWZyZXNoVG9rZW4gfTtcbiAgfVxuXG4gIC8vIFJlZnJlc2ggYWNjZXNzIHRva2VuIHVzaW5nIHJlZnJlc2ggdG9rZW5cbiAgYXN5bmMgcmVmcmVzaEFjY2Vzc1Rva2VuKHJlZnJlc2hUb2tlbjogc3RyaW5nKTogUHJvbWlzZTx7XG4gICAgc3VjY2VzczogYm9vbGVhbjtcbiAgICBhY2Nlc3NUb2tlbj86IHN0cmluZztcbiAgICByZWZyZXNoVG9rZW4/OiBzdHJpbmc7XG4gICAgZXJyb3I/OiBzdHJpbmc7XG4gIH0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgdG9rZW5EYXRhID0gYXdhaXQgdGhpcy52ZXJpZnlSZWZyZXNoVG9rZW4ocmVmcmVzaFRva2VuKTtcbiAgICAgIGlmICghdG9rZW5EYXRhKSB7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0ludmFsaWQgb3IgZXhwaXJlZCByZWZyZXNoIHRva2VuJyB9O1xuICAgICAgfVxuXG4gICAgICBjb25zdCB1c2VyID0gZGF0YWJhc2UuZ2V0VXNlckJ5SWQodG9rZW5EYXRhLnVzZXJJZCk7XG4gICAgICBpZiAoIXVzZXIpIHtcbiAgICAgICAgZGF0YWJhc2UucmV2b2tlUmVmcmVzaFRva2VuKHRva2VuRGF0YS50b2tlbkhhc2gpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdVc2VyIG5vdCBmb3VuZCcgfTtcbiAgICAgIH1cblxuICAgICAgLy8gUmV2b2tlIG9sZCByZWZyZXNoIHRva2VuXG4gICAgICBkYXRhYmFzZS5yZXZva2VSZWZyZXNoVG9rZW4odG9rZW5EYXRhLnRva2VuSGFzaCk7XG5cbiAgICAgIC8vIENyZWF0ZSBuZXcgdG9rZW5zXG4gICAgICBjb25zdCB0b2tlbnMgPSB0aGlzLmNyZWF0ZUF1dGhUb2tlbnModXNlcik7XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIGFjY2Vzc1Rva2VuOiB0b2tlbnMuYWNjZXNzVG9rZW4sXG4gICAgICAgIHJlZnJlc2hUb2tlbjogdG9rZW5zLnJlZnJlc2hUb2tlblxuICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignVG9rZW4gcmVmcmVzaCBmYWlsZWQ6JywgZXJyb3IpO1xuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnVG9rZW4gcmVmcmVzaCBmYWlsZWQnIH07XG4gICAgfVxuICB9XG5cbiAgLy8gUmV2b2tlIGFsbCB1c2VyIHRva2VucyAobG9nb3V0IGZyb20gYWxsIGRldmljZXMpXG4gIHJldm9rZUFsbFVzZXJUb2tlbnModXNlcklkOiBzdHJpbmcpOiB2b2lkIHtcbiAgICBkYXRhYmFzZS5yZXZva2VBbGxVc2VyUmVmcmVzaFRva2Vucyh1c2VySWQpO1xuICB9XG5cbiAgLy8gUmV2b2tlIHNwZWNpZmljIHJlZnJlc2ggdG9rZW4gKGxvZ291dCBmcm9tIHNwZWNpZmljIGRldmljZSlcbiAgcmV2b2tlUmVmcmVzaFRva2VuKHJlZnJlc2hUb2tlbjogc3RyaW5nKTogYm9vbGVhbiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHRva2VuSGFzaCA9IGNyeXB0by5jcmVhdGVIYXNoKCdzaGEyNTYnKS51cGRhdGUocmVmcmVzaFRva2VuKS5kaWdlc3QoJ2hleCcpO1xuICAgICAgZGF0YWJhc2UucmV2b2tlUmVmcmVzaFRva2VuKHRva2VuSGFzaCk7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignVG9rZW4gcmV2b2NhdGlvbiBmYWlsZWQ6JywgZXJyb3IpO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gIC8vIENvbnZlcnQgVXNlciB0byBQdWJsaWNVc2VyIChyZW1vdmUgc2Vuc2l0aXZlIGRhdGEpXG4gIHRvUHVibGljVXNlcih1c2VyOiBVc2VyKTogUHVibGljVXNlciB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGlkOiB1c2VyLmlkLFxuICAgICAgZW1haWw6IHVzZXIuZW1haWwsXG4gICAgICBuYW1lOiB1c2VyLm5hbWUsXG4gICAgICByZXN0YXVyYW50TmFtZTogdXNlci5yZXN0YXVyYW50TmFtZSxcbiAgICAgIGN1aXNpbmVUeXBlOiB1c2VyLmN1aXNpbmVUeXBlLFxuICAgICAgbG9jYXRpb246IHVzZXIubG9jYXRpb24sXG4gICAgICBwaG9uZTogdXNlci5waG9uZSxcbiAgICAgIHJvbGU6IHVzZXIucm9sZSxcbiAgICAgIHN1YnNjcmlwdGlvblN0YXR1czogdXNlci5zdWJzY3JpcHRpb25TdGF0dXMsXG4gICAgICB0cmlhbEVuZERhdGU6IHVzZXIudHJpYWxFbmREYXRlLFxuICAgICAgc3RyaXBlQ3VzdG9tZXJJZDogdXNlci5zdHJpcGVDdXN0b21lcklkLFxuICAgICAgZW1haWxWZXJpZmllZDogdXNlci5lbWFpbFZlcmlmaWVkLFxuICAgICAgb25ib2FyZGluZ0NvbXBsZXRlZDogdXNlci5vbmJvYXJkaW5nQ29tcGxldGVkLFxuICAgICAgY3JlYXRlZEF0OiB1c2VyLmNyZWF0ZWRBdCxcbiAgICAgIGxhc3RMb2dpbkF0OiB1c2VyLmxhc3RMb2dpbkF0XG4gICAgfTtcbiAgfVxuXG4gIC8vIENsZWFuIHVwIGV4cGlyZWQgdG9rZW5zIChzaG91bGQgYmUgcnVuIHBlcmlvZGljYWxseSlcbiAgY2xlYW51cCgpOiB2b2lkIHtcbiAgICBkYXRhYmFzZS5jbGVhbnVwRXhwaXJlZFRva2VucygpO1xuICB9XG5cbiAgLy8gQ2hlY2sgaWYgdXNlciBoYXMgcmVxdWlyZWQgcm9sZVxuICBoYXNSb2xlKHVzZXI6IFVzZXIsIHJlcXVpcmVkUm9sZTogc3RyaW5nIHwgc3RyaW5nW10pOiBib29sZWFuIHtcbiAgICBjb25zdCByb2xlcyA9IEFycmF5LmlzQXJyYXkocmVxdWlyZWRSb2xlKSA/IHJlcXVpcmVkUm9sZSA6IFtyZXF1aXJlZFJvbGVdO1xuICAgIHJldHVybiByb2xlcy5pbmNsdWRlcyh1c2VyLnJvbGUpO1xuICB9XG5cbiAgLy8gQ2hlY2sgaWYgdXNlciBpcyBhZG1pblxuICBpc0FkbWluKHVzZXI6IFVzZXIpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdXNlci5yb2xlID09PSAnYWRtaW4nO1xuICB9XG5cbiAgLy8gQ2hlY2sgaWYgdXNlciBjYW4gYWNjZXNzIHJlc291cmNlXG4gIGNhbkFjY2Vzc1Jlc291cmNlKHVzZXI6IFVzZXIsIHJlc291cmNlVXNlcklkOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICAvLyBVc2VycyBjYW4gYWNjZXNzIHRoZWlyIG93biByZXNvdXJjZXMsIGFkbWlucyBjYW4gYWNjZXNzIGFsbFxuICAgIHJldHVybiB1c2VyLmlkID09PSByZXNvdXJjZVVzZXJJZCB8fCB0aGlzLmlzQWRtaW4odXNlcik7XG4gIH1cblxuICAvLyBSYXRlIGxpbWl0aW5nIGhlbHBlclxuICBnZXRSYXRlTGltaXRLZXkoaWRlbnRpZmllcjogc3RyaW5nLCBhY3Rpb246IHN0cmluZyk6IHN0cmluZyB7XG4gICAgcmV0dXJuIGByYXRlbGltaXQ6JHthY3Rpb259OiR7aWRlbnRpZmllcn1gO1xuICB9XG5cbiAgLy8gR2VuZXJhdGUgc2VjdXJlIHJhbmRvbSB0b2tlblxuICBnZW5lcmF0ZVNlY3VyZVRva2VuKGxlbmd0aDogbnVtYmVyID0gMzIpOiBzdHJpbmcge1xuICAgIHJldHVybiBjcnlwdG8ucmFuZG9tQnl0ZXMobGVuZ3RoKS50b1N0cmluZygnaGV4Jyk7XG4gIH1cblxuICAvLyBWYWxpZGF0ZSB0b2tlbiBmb3JtYXRcbiAgaXNWYWxpZFRva2VuRm9ybWF0KHRva2VuOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICAvLyBDaGVjayBpZiB0b2tlbiBsb29rcyBsaWtlIGEgSldUIChoYXMgMyBwYXJ0cyBzZXBhcmF0ZWQgYnkgZG90cylcbiAgICBjb25zdCBwYXJ0cyA9IHRva2VuLnNwbGl0KCcuJyk7XG4gICAgcmV0dXJuIHBhcnRzLmxlbmd0aCA9PT0gMyAmJiBwYXJ0cy5ldmVyeShwYXJ0ID0+IHBhcnQubGVuZ3RoID4gMCk7XG4gIH1cblxuICAvLyBDcmVhdGUgcGFzc3dvcmQgcmVzZXQgdG9rZW5cbiAgY3JlYXRlUGFzc3dvcmRSZXNldFRva2VuKHVzZXJJZDogc3RyaW5nKTogeyB0b2tlbjogc3RyaW5nOyBleHBpcmVzQXQ6IERhdGUgfSB7XG4gICAgY29uc3QgdG9rZW4gPSB0aGlzLmdlbmVyYXRlU2VjdXJlVG9rZW4oMzIpO1xuICAgIGNvbnN0IGV4cGlyZXNBdCA9IG5ldyBEYXRlKERhdGUubm93KCkgKyA2MCAqIDYwICogMTAwMCk7IC8vIDEgaG91clxuXG4gICAgLy8gSW4gYSByZWFsIGFwcCwgeW91J2Qgc3RvcmUgdGhpcyBpbiBhIHNlcGFyYXRlIHRhYmxlXG4gICAgLy8gRm9yIG5vdywgd2UnbGwgdXNlIGEgc2ltcGxlIGluLW1lbW9yeSBzdG9yZSBvciBkYXRhYmFzZVxuICAgIFxuICAgIHJldHVybiB7IHRva2VuLCBleHBpcmVzQXQgfTtcbiAgfVxuXG4gIC8vIENyZWF0ZSBlbWFpbCB2ZXJpZmljYXRpb24gdG9rZW5cbiAgY3JlYXRlRW1haWxWZXJpZmljYXRpb25Ub2tlbih1c2VySWQ6IHN0cmluZyk6IHsgdG9rZW46IHN0cmluZzsgZXhwaXJlc0F0OiBEYXRlIH0ge1xuICAgIGNvbnN0IHRva2VuID0gdGhpcy5nZW5lcmF0ZVNlY3VyZVRva2VuKDMyKTtcbiAgICBjb25zdCBleHBpcmVzQXQgPSBuZXcgRGF0ZShEYXRlLm5vdygpICsgMjQgKiA2MCAqIDYwICogMTAwMCk7IC8vIDI0IGhvdXJzXG5cbiAgICByZXR1cm4geyB0b2tlbiwgZXhwaXJlc0F0IH07XG4gIH1cbn1cblxuLy8gU2luZ2xldG9uIGluc3RhbmNlXG5leHBvcnQgY29uc3QgYXV0aFNlcnZpY2UgPSBuZXcgQXV0aFNlcnZpY2UoKTtcblxuLy8gTWlkZGxld2FyZSBoZWxwZXIgZnVuY3Rpb25zXG5leHBvcnQgZnVuY3Rpb24gcmVxdWlyZUF1dGgoaGFuZGxlcjogKHJlcXVlc3Q6IE5leHRSZXF1ZXN0LCB1c2VyOiBVc2VyKSA9PiBQcm9taXNlPFJlc3BvbnNlPikge1xuICByZXR1cm4gYXN5bmMgKHJlcXVlc3Q6IE5leHRSZXF1ZXN0KTogUHJvbWlzZTxSZXNwb25zZT4gPT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB1c2VyID0gYXdhaXQgYXV0aFNlcnZpY2UuZ2V0VXNlckZyb21SZXF1ZXN0KHJlcXVlc3QpO1xuICAgICAgXG4gICAgICBpZiAoIXVzZXIpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBSZXNwb25zZShcbiAgICAgICAgICBKU09OLnN0cmluZ2lmeSh7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0F1dGhlbnRpY2F0aW9uIHJlcXVpcmVkJyB9KSxcbiAgICAgICAgICB7IHN0YXR1czogNDAxLCBoZWFkZXJzOiB7ICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicgfSB9XG4gICAgICAgICk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBoYW5kbGVyKHJlcXVlc3QsIHVzZXIpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdBdXRoIG1pZGRsZXdhcmUgZXJyb3I6JywgZXJyb3IpO1xuICAgICAgcmV0dXJuIG5ldyBSZXNwb25zZShcbiAgICAgICAgSlNPTi5zdHJpbmdpZnkoeyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdBdXRoZW50aWNhdGlvbiBmYWlsZWQnIH0pLFxuICAgICAgICB7IHN0YXR1czogNDAxLCBoZWFkZXJzOiB7ICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicgfSB9XG4gICAgICApO1xuICAgIH1cbiAgfTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHJlcXVpcmVSb2xlKHJvbGVzOiBzdHJpbmcgfCBzdHJpbmdbXSkge1xuICByZXR1cm4gZnVuY3Rpb24oaGFuZGxlcjogKHJlcXVlc3Q6IE5leHRSZXF1ZXN0LCB1c2VyOiBVc2VyKSA9PiBQcm9taXNlPFJlc3BvbnNlPikge1xuICAgIHJldHVybiBhc3luYyAocmVxdWVzdDogTmV4dFJlcXVlc3QpOiBQcm9taXNlPFJlc3BvbnNlPiA9PiB7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCB1c2VyID0gYXdhaXQgYXV0aFNlcnZpY2UuZ2V0VXNlckZyb21SZXF1ZXN0KHJlcXVlc3QpO1xuICAgICAgICBcbiAgICAgICAgaWYgKCF1c2VyKSB7XG4gICAgICAgICAgcmV0dXJuIG5ldyBSZXNwb25zZShcbiAgICAgICAgICAgIEpTT04uc3RyaW5naWZ5KHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnQXV0aGVudGljYXRpb24gcmVxdWlyZWQnIH0pLFxuICAgICAgICAgICAgeyBzdGF0dXM6IDQwMSwgaGVhZGVyczogeyAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nIH0gfVxuICAgICAgICAgICk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIWF1dGhTZXJ2aWNlLmhhc1JvbGUodXNlciwgcm9sZXMpKSB7XG4gICAgICAgICAgcmV0dXJuIG5ldyBSZXNwb25zZShcbiAgICAgICAgICAgIEpTT04uc3RyaW5naWZ5KHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnSW5zdWZmaWNpZW50IHBlcm1pc3Npb25zJyB9KSxcbiAgICAgICAgICAgIHsgc3RhdHVzOiA0MDMsIGhlYWRlcnM6IHsgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyB9IH1cbiAgICAgICAgICApO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGhhbmRsZXIocmVxdWVzdCwgdXNlcik7XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKCdSb2xlIG1pZGRsZXdhcmUgZXJyb3I6JywgZXJyb3IpO1xuICAgICAgICByZXR1cm4gbmV3IFJlc3BvbnNlKFxuICAgICAgICAgIEpTT04uc3RyaW5naWZ5KHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnQXV0aG9yaXphdGlvbiBmYWlsZWQnIH0pLFxuICAgICAgICAgIHsgc3RhdHVzOiA0MDMsIGhlYWRlcnM6IHsgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyB9IH1cbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9O1xuICB9O1xufSAiXSwibmFtZXMiOlsiand0IiwiYmNyeXB0IiwiY3J5cHRvIiwiZGF0YWJhc2UiLCJKV1RfU0VDUkVUIiwicHJvY2VzcyIsImVudiIsIkpXVF9SRUZSRVNIX1NFQ1JFVCIsIkFDQ0VTU19UT0tFTl9FWFBJUlkiLCJSRUZSRVNIX1RPS0VOX0VYUElSWSIsIkF1dGhTZXJ2aWNlIiwiZ2VuZXJhdGVBY2Nlc3NUb2tlbiIsInBheWxvYWQiLCJzaWduIiwiZXhwaXJlc0luIiwiaXNzdWVyIiwiYXVkaWVuY2UiLCJnZW5lcmF0ZVJlZnJlc2hUb2tlbiIsInVzZXJJZCIsInRva2VuIiwicmFuZG9tQnl0ZXMiLCJ0b1N0cmluZyIsInRva2VuSGFzaCIsImNyZWF0ZUhhc2giLCJ1cGRhdGUiLCJkaWdlc3QiLCJleHBpcmVzQXQiLCJEYXRlIiwibm93IiwiY3JlYXRlUmVmcmVzaFRva2VuIiwidmVyaWZ5QWNjZXNzVG9rZW4iLCJkZWNvZGVkIiwidmVyaWZ5IiwiZXJyb3IiLCJjb25zb2xlIiwidmVyaWZ5UmVmcmVzaFRva2VuIiwicmVmcmVzaFRva2VuIiwiZ2V0UmVmcmVzaFRva2VuIiwicmV2b2tlUmVmcmVzaFRva2VuIiwiaGFzaFBhc3N3b3JkIiwicGFzc3dvcmQiLCJzYWx0Um91bmRzIiwiaGFzaCIsInZlcmlmeVBhc3N3b3JkIiwiaGFzaGVkUGFzc3dvcmQiLCJjb21wYXJlIiwiZ2V0VXNlckZyb21SZXF1ZXN0IiwicmVxdWVzdCIsImV4dHJhY3RUb2tlbkZyb21SZXF1ZXN0IiwiZ2V0VXNlckJ5SWQiLCJhdXRoSGVhZGVyIiwiaGVhZGVycyIsImdldCIsInBhcnRzIiwic3BsaXQiLCJsZW5ndGgiLCJjcmVhdGVBdXRoVG9rZW5zIiwidXNlciIsImlkIiwiZW1haWwiLCJyb2xlIiwiYWNjZXNzVG9rZW4iLCJyZWZyZXNoQWNjZXNzVG9rZW4iLCJ0b2tlbkRhdGEiLCJzdWNjZXNzIiwidG9rZW5zIiwicmV2b2tlQWxsVXNlclRva2VucyIsInJldm9rZUFsbFVzZXJSZWZyZXNoVG9rZW5zIiwidG9QdWJsaWNVc2VyIiwibmFtZSIsInJlc3RhdXJhbnROYW1lIiwiY3Vpc2luZVR5cGUiLCJsb2NhdGlvbiIsInBob25lIiwic3Vic2NyaXB0aW9uU3RhdHVzIiwidHJpYWxFbmREYXRlIiwic3RyaXBlQ3VzdG9tZXJJZCIsImVtYWlsVmVyaWZpZWQiLCJvbmJvYXJkaW5nQ29tcGxldGVkIiwiY3JlYXRlZEF0IiwibGFzdExvZ2luQXQiLCJjbGVhbnVwIiwiY2xlYW51cEV4cGlyZWRUb2tlbnMiLCJoYXNSb2xlIiwicmVxdWlyZWRSb2xlIiwicm9sZXMiLCJBcnJheSIsImlzQXJyYXkiLCJpbmNsdWRlcyIsImlzQWRtaW4iLCJjYW5BY2Nlc3NSZXNvdXJjZSIsInJlc291cmNlVXNlcklkIiwiZ2V0UmF0ZUxpbWl0S2V5IiwiaWRlbnRpZmllciIsImFjdGlvbiIsImdlbmVyYXRlU2VjdXJlVG9rZW4iLCJpc1ZhbGlkVG9rZW5Gb3JtYXQiLCJldmVyeSIsInBhcnQiLCJjcmVhdGVQYXNzd29yZFJlc2V0VG9rZW4iLCJjcmVhdGVFbWFpbFZlcmlmaWNhdGlvblRva2VuIiwiYXV0aFNlcnZpY2UiLCJyZXF1aXJlQXV0aCIsImhhbmRsZXIiLCJSZXNwb25zZSIsIkpTT04iLCJzdHJpbmdpZnkiLCJzdGF0dXMiLCJyZXF1aXJlUm9sZSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/auth.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/database.ts":
/*!*****************************!*\
  !*** ./src/lib/database.ts ***!
  \*****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   DatabaseOperations: () => (/* binding */ DatabaseOperations),\n/* harmony export */   database: () => (/* binding */ database),\n/* harmony export */   initDatabase: () => (/* binding */ initDatabase)\n/* harmony export */ });\n/* harmony import */ var better_sqlite3__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! better-sqlite3 */ \"better-sqlite3\");\n/* harmony import */ var better_sqlite3__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(better_sqlite3__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! path */ \"path\");\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(path__WEBPACK_IMPORTED_MODULE_1__);\n\n\n// Database instance\nlet db;\n// Initialize database connection\nfunction initDatabase() {\n    if (db) return db;\n    const dbPath = path__WEBPACK_IMPORTED_MODULE_1___default().join(process.cwd(), \"data\", \"chefsocial.db\");\n    try {\n        // Ensure data directory exists\n        const fs = __webpack_require__(/*! fs */ \"fs\");\n        const dataDir = path__WEBPACK_IMPORTED_MODULE_1___default().dirname(dbPath);\n        if (!fs.existsSync(dataDir)) {\n            fs.mkdirSync(dataDir, {\n                recursive: true\n            });\n        }\n        db = new (better_sqlite3__WEBPACK_IMPORTED_MODULE_0___default())(dbPath);\n        db.pragma(\"journal_mode = WAL\"); // Better performance for concurrent reads\n        db.pragma(\"synchronous = NORMAL\"); // Balance between safety and performance\n        // Create tables\n        createTables();\n        console.log(\"Database initialized successfully\");\n        return db;\n    } catch (error) {\n        console.error(\"Failed to initialize database:\", error);\n        throw error;\n    }\n}\n// Create database tables\nfunction createTables() {\n    // Users table\n    db.exec(`\n    CREATE TABLE IF NOT EXISTS users (\n      id TEXT PRIMARY KEY,\n      email TEXT UNIQUE NOT NULL,\n      password_hash TEXT NOT NULL,\n      name TEXT NOT NULL,\n      restaurant_name TEXT NOT NULL,\n      cuisine_type TEXT DEFAULT '',\n      location TEXT DEFAULT '',\n      phone TEXT DEFAULT '',\n      role TEXT DEFAULT 'user',\n      subscription_status TEXT DEFAULT 'trialing',\n      trial_start_date TEXT,\n      trial_end_date TEXT,\n      stripe_customer_id TEXT,\n      stripe_subscription_id TEXT,\n      marketing_consent BOOLEAN DEFAULT false,\n      email_verified BOOLEAN DEFAULT false,\n      onboarding_completed BOOLEAN DEFAULT false,\n      created_at TEXT NOT NULL,\n      updated_at TEXT NOT NULL,\n      last_login_at TEXT\n    )\n  `);\n    // Refresh tokens table\n    db.exec(`\n    CREATE TABLE IF NOT EXISTS refresh_tokens (\n      id TEXT PRIMARY KEY,\n      user_id TEXT NOT NULL,\n      token_hash TEXT NOT NULL,\n      expires_at TEXT NOT NULL,\n      created_at TEXT NOT NULL,\n      revoked BOOLEAN DEFAULT false,\n      FOREIGN KEY (user_id) REFERENCES users (id) ON DELETE CASCADE\n    )\n  `);\n    // API rate limiting table\n    db.exec(`\n    CREATE TABLE IF NOT EXISTS rate_limits (\n      key TEXT PRIMARY KEY,\n      requests INTEGER DEFAULT 0,\n      window_start TEXT NOT NULL,\n      created_at TEXT NOT NULL,\n      updated_at TEXT NOT NULL\n    )\n  `);\n    // Create indexes for better performance\n    db.exec(`\n    CREATE INDEX IF NOT EXISTS idx_users_email ON users(email);\n    CREATE INDEX IF NOT EXISTS idx_refresh_tokens_user_id ON refresh_tokens(user_id);\n    CREATE INDEX IF NOT EXISTS idx_refresh_tokens_expires_at ON refresh_tokens(expires_at);\n    CREATE INDEX IF NOT EXISTS idx_rate_limits_window_start ON rate_limits(window_start);\n  `);\n    console.log(\"Database tables created successfully\");\n}\n// Database operations\nclass DatabaseOperations {\n    constructor(){\n        this.db = initDatabase();\n        createTables(); // Ensure tables are created\n    }\n    // User operations\n    async createUser(userData) {\n        const id = `user_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n        const now = new Date().toISOString();\n        const stmt = this.db.prepare(`\n      INSERT INTO users (\n        id, email, password_hash, name, restaurant_name, cuisine_type,\n        location, phone, role, subscription_status, trial_start_date,\n        trial_end_date, stripe_customer_id, stripe_subscription_id,\n        marketing_consent, email_verified, onboarding_completed,\n        created_at, updated_at\n      ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)\n    `);\n        try {\n            stmt.run(id, userData.email, userData.passwordHash, userData.name, userData.restaurantName, userData.cuisineType || \"\", userData.location || \"\", userData.phone || \"\", userData.role || \"user\", userData.subscriptionStatus || \"trialing\", userData.trialStartDate, userData.trialEndDate, userData.stripeCustomerId, userData.stripeSubscriptionId, userData.marketingConsent ? 1 : 0, userData.emailVerified ? 1 : 0, userData.onboardingCompleted ? 1 : 0, now, now);\n            return this.getUserById(id);\n        } catch (error) {\n            if (error.code === \"SQLITE_CONSTRAINT_UNIQUE\") {\n                throw new Error(\"User with this email already exists\");\n            }\n            throw error;\n        }\n    }\n    getUserByEmail(email) {\n        const stmt = this.db.prepare(\"SELECT * FROM users WHERE email = ? LIMIT 1\");\n        const row = stmt.get(email);\n        return row ? this.mapRowToUser(row) : null;\n    }\n    getUserById(id) {\n        const stmt = this.db.prepare(\"SELECT * FROM users WHERE id = ? LIMIT 1\");\n        const row = stmt.get(id);\n        return row ? this.mapRowToUser(row) : null;\n    }\n    updateUser(id, updates) {\n        const updateFields = Object.keys(updates).filter((key)=>key !== \"id\" && key !== \"createdAt\").map((key)=>`${this.camelToSnake(key)} = ?`).join(\", \");\n        if (!updateFields) return this.getUserById(id);\n        const values = Object.keys(updates).filter((key)=>key !== \"id\" && key !== \"createdAt\").map((key)=>updates[key]);\n        const stmt = this.db.prepare(`\n      UPDATE users \n      SET ${updateFields}, updated_at = ?\n      WHERE id = ?\n    `);\n        stmt.run(...values, new Date().toISOString(), id);\n        return this.getUserById(id);\n    }\n    updateLastLogin(id) {\n        const stmt = this.db.prepare(\"UPDATE users SET last_login_at = ? WHERE id = ?\");\n        stmt.run(new Date().toISOString(), id);\n    }\n    // Refresh token operations\n    createRefreshToken(userId, tokenHash, expiresAt) {\n        const id = `rt_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n        const stmt = this.db.prepare(`\n      INSERT INTO refresh_tokens (id, user_id, token_hash, expires_at, created_at)\n      VALUES (?, ?, ?, ?, ?)\n    `);\n        stmt.run(id, userId, tokenHash, expiresAt.toISOString(), new Date().toISOString());\n        return id;\n    }\n    getRefreshToken(tokenHash) {\n        const stmt = this.db.prepare(`\n      SELECT * FROM refresh_tokens \n      WHERE token_hash = ? AND revoked = false AND expires_at > datetime('now')\n      LIMIT 1\n    `);\n        const row = stmt.get(tokenHash);\n        if (!row) return null;\n        return {\n            id: row.id,\n            userId: row.user_id,\n            tokenHash: row.token_hash,\n            expiresAt: new Date(row.expires_at),\n            createdAt: new Date(row.created_at),\n            revoked: Boolean(row.revoked)\n        };\n    }\n    revokeRefreshToken(tokenHash) {\n        const stmt = this.db.prepare(\"UPDATE refresh_tokens SET revoked = true WHERE token_hash = ?\");\n        stmt.run(tokenHash);\n    }\n    revokeAllUserRefreshTokens(userId) {\n        const stmt = this.db.prepare(\"UPDATE refresh_tokens SET revoked = true WHERE user_id = ?\");\n        stmt.run(userId);\n    }\n    // Clean up expired tokens\n    cleanupExpiredTokens() {\n        const stmt = this.db.prepare(\"DELETE FROM refresh_tokens WHERE expires_at < datetime('now')\");\n        const result = stmt.run();\n        if (result.changes > 0) {\n            console.log(`Cleaned up ${result.changes} expired refresh tokens`);\n        }\n    }\n    // Rate limiting operations\n    getRateLimit(key) {\n        const stmt = this.db.prepare(\"SELECT * FROM rate_limits WHERE key = ? LIMIT 1\");\n        const row = stmt.get(key);\n        if (!row) return null;\n        return {\n            requests: row.requests,\n            windowStart: new Date(row.window_start)\n        };\n    }\n    updateRateLimit(key, requests, windowStart) {\n        const now = new Date().toISOString();\n        const stmt = this.db.prepare(`\n      INSERT OR REPLACE INTO rate_limits (key, requests, window_start, created_at, updated_at)\n      VALUES (?, ?, ?, COALESCE((SELECT created_at FROM rate_limits WHERE key = ?), ?), ?)\n    `);\n        stmt.run(key, requests, windowStart.toISOString(), key, now, now);\n    }\n    // Utility methods\n    mapRowToUser(row) {\n        return {\n            id: row.id,\n            email: row.email,\n            passwordHash: row.password_hash,\n            name: row.name,\n            restaurantName: row.restaurant_name,\n            cuisineType: row.cuisine_type,\n            location: row.location,\n            phone: row.phone,\n            role: row.role,\n            subscriptionStatus: row.subscription_status,\n            trialStartDate: row.trial_start_date,\n            trialEndDate: row.trial_end_date,\n            stripeCustomerId: row.stripe_customer_id,\n            stripeSubscriptionId: row.stripe_subscription_id,\n            marketingConsent: Boolean(row.marketing_consent),\n            emailVerified: Boolean(row.email_verified),\n            onboardingCompleted: Boolean(row.onboarding_completed),\n            createdAt: row.created_at,\n            updatedAt: row.updated_at,\n            lastLoginAt: row.last_login_at\n        };\n    }\n    camelToSnake(str) {\n        return str.replace(/[A-Z]/g, (letter)=>`_${letter.toLowerCase()}`);\n    }\n    // Health check\n    healthCheck() {\n        try {\n            this.db.prepare(\"SELECT 1\").get();\n            return true;\n        } catch (error) {\n            console.error(\"Database health check failed:\", error);\n            return false;\n        }\n    }\n    // Close database connection\n    close() {\n        if (this.db) {\n            this.db.close();\n        }\n    }\n}\n// Singleton instance\nconst database = new DatabaseOperations();\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LElBQUksQ0FBQzlHLEVBQUUsRUFBRTtZQUNYLElBQUksQ0FBQ0EsRUFBRSxDQUFDOEcsS0FBSztRQUNmO0lBQ0Y7QUFDRjtBQUVBLHFCQUFxQjtBQUNkLE1BQU1DLFdBQVcsSUFBSTVGLHFCQUFxQiIsInNvdXJjZXMiOlsid2VicGFjazovL2NoZWZzb2NpYWwtbmV4dC8uL3NyYy9saWIvZGF0YWJhc2UudHM/YzFiMCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgRGF0YWJhc2UgZnJvbSAnYmV0dGVyLXNxbGl0ZTMnO1xuaW1wb3J0IHBhdGggZnJvbSAncGF0aCc7XG5pbXBvcnQgeyBVc2VyLCBSZWZyZXNoVG9rZW4gfSBmcm9tICcuLi90eXBlcy9hdXRoJztcblxuLy8gRGF0YWJhc2UgaW5zdGFuY2VcbmxldCBkYjogRGF0YWJhc2UuRGF0YWJhc2U7XG5cbi8vIEluaXRpYWxpemUgZGF0YWJhc2UgY29ubmVjdGlvblxuZXhwb3J0IGZ1bmN0aW9uIGluaXREYXRhYmFzZSgpIHtcbiAgaWYgKGRiKSByZXR1cm4gZGI7XG5cbiAgY29uc3QgZGJQYXRoID0gcGF0aC5qb2luKHByb2Nlc3MuY3dkKCksICdkYXRhJywgJ2NoZWZzb2NpYWwuZGInKTtcbiAgXG4gIHRyeSB7XG4gICAgLy8gRW5zdXJlIGRhdGEgZGlyZWN0b3J5IGV4aXN0c1xuICAgIGNvbnN0IGZzID0gcmVxdWlyZSgnZnMnKTtcbiAgICBjb25zdCBkYXRhRGlyID0gcGF0aC5kaXJuYW1lKGRiUGF0aCk7XG4gICAgaWYgKCFmcy5leGlzdHNTeW5jKGRhdGFEaXIpKSB7XG4gICAgICBmcy5ta2RpclN5bmMoZGF0YURpciwgeyByZWN1cnNpdmU6IHRydWUgfSk7XG4gICAgfVxuXG4gICAgZGIgPSBuZXcgRGF0YWJhc2UoZGJQYXRoKTtcbiAgICBkYi5wcmFnbWEoJ2pvdXJuYWxfbW9kZSA9IFdBTCcpOyAvLyBCZXR0ZXIgcGVyZm9ybWFuY2UgZm9yIGNvbmN1cnJlbnQgcmVhZHNcbiAgICBkYi5wcmFnbWEoJ3N5bmNocm9ub3VzID0gTk9STUFMJyk7IC8vIEJhbGFuY2UgYmV0d2VlbiBzYWZldHkgYW5kIHBlcmZvcm1hbmNlXG4gICAgXG4gICAgLy8gQ3JlYXRlIHRhYmxlc1xuICAgIGNyZWF0ZVRhYmxlcygpO1xuICAgIFxuICAgIGNvbnNvbGUubG9nKCdEYXRhYmFzZSBpbml0aWFsaXplZCBzdWNjZXNzZnVsbHknKTtcbiAgICByZXR1cm4gZGI7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIGluaXRpYWxpemUgZGF0YWJhc2U6JywgZXJyb3IpO1xuICAgIHRocm93IGVycm9yO1xuICB9XG59XG5cbi8vIENyZWF0ZSBkYXRhYmFzZSB0YWJsZXNcbmZ1bmN0aW9uIGNyZWF0ZVRhYmxlcygpIHtcbiAgLy8gVXNlcnMgdGFibGVcbiAgZGIuZXhlYyhgXG4gICAgQ1JFQVRFIFRBQkxFIElGIE5PVCBFWElTVFMgdXNlcnMgKFxuICAgICAgaWQgVEVYVCBQUklNQVJZIEtFWSxcbiAgICAgIGVtYWlsIFRFWFQgVU5JUVVFIE5PVCBOVUxMLFxuICAgICAgcGFzc3dvcmRfaGFzaCBURVhUIE5PVCBOVUxMLFxuICAgICAgbmFtZSBURVhUIE5PVCBOVUxMLFxuICAgICAgcmVzdGF1cmFudF9uYW1lIFRFWFQgTk9UIE5VTEwsXG4gICAgICBjdWlzaW5lX3R5cGUgVEVYVCBERUZBVUxUICcnLFxuICAgICAgbG9jYXRpb24gVEVYVCBERUZBVUxUICcnLFxuICAgICAgcGhvbmUgVEVYVCBERUZBVUxUICcnLFxuICAgICAgcm9sZSBURVhUIERFRkFVTFQgJ3VzZXInLFxuICAgICAgc3Vic2NyaXB0aW9uX3N0YXR1cyBURVhUIERFRkFVTFQgJ3RyaWFsaW5nJyxcbiAgICAgIHRyaWFsX3N0YXJ0X2RhdGUgVEVYVCxcbiAgICAgIHRyaWFsX2VuZF9kYXRlIFRFWFQsXG4gICAgICBzdHJpcGVfY3VzdG9tZXJfaWQgVEVYVCxcbiAgICAgIHN0cmlwZV9zdWJzY3JpcHRpb25faWQgVEVYVCxcbiAgICAgIG1hcmtldGluZ19jb25zZW50IEJPT0xFQU4gREVGQVVMVCBmYWxzZSxcbiAgICAgIGVtYWlsX3ZlcmlmaWVkIEJPT0xFQU4gREVGQVVMVCBmYWxzZSxcbiAgICAgIG9uYm9hcmRpbmdfY29tcGxldGVkIEJPT0xFQU4gREVGQVVMVCBmYWxzZSxcbiAgICAgIGNyZWF0ZWRfYXQgVEVYVCBOT1QgTlVMTCxcbiAgICAgIHVwZGF0ZWRfYXQgVEVYVCBOT1QgTlVMTCxcbiAgICAgIGxhc3RfbG9naW5fYXQgVEVYVFxuICAgIClcbiAgYCk7XG5cbiAgLy8gUmVmcmVzaCB0b2tlbnMgdGFibGVcbiAgZGIuZXhlYyhgXG4gICAgQ1JFQVRFIFRBQkxFIElGIE5PVCBFWElTVFMgcmVmcmVzaF90b2tlbnMgKFxuICAgICAgaWQgVEVYVCBQUklNQVJZIEtFWSxcbiAgICAgIHVzZXJfaWQgVEVYVCBOT1QgTlVMTCxcbiAgICAgIHRva2VuX2hhc2ggVEVYVCBOT1QgTlVMTCxcbiAgICAgIGV4cGlyZXNfYXQgVEVYVCBOT1QgTlVMTCxcbiAgICAgIGNyZWF0ZWRfYXQgVEVYVCBOT1QgTlVMTCxcbiAgICAgIHJldm9rZWQgQk9PTEVBTiBERUZBVUxUIGZhbHNlLFxuICAgICAgRk9SRUlHTiBLRVkgKHVzZXJfaWQpIFJFRkVSRU5DRVMgdXNlcnMgKGlkKSBPTiBERUxFVEUgQ0FTQ0FERVxuICAgIClcbiAgYCk7XG5cbiAgLy8gQVBJIHJhdGUgbGltaXRpbmcgdGFibGVcbiAgZGIuZXhlYyhgXG4gICAgQ1JFQVRFIFRBQkxFIElGIE5PVCBFWElTVFMgcmF0ZV9saW1pdHMgKFxuICAgICAga2V5IFRFWFQgUFJJTUFSWSBLRVksXG4gICAgICByZXF1ZXN0cyBJTlRFR0VSIERFRkFVTFQgMCxcbiAgICAgIHdpbmRvd19zdGFydCBURVhUIE5PVCBOVUxMLFxuICAgICAgY3JlYXRlZF9hdCBURVhUIE5PVCBOVUxMLFxuICAgICAgdXBkYXRlZF9hdCBURVhUIE5PVCBOVUxMXG4gICAgKVxuICBgKTtcblxuICAvLyBDcmVhdGUgaW5kZXhlcyBmb3IgYmV0dGVyIHBlcmZvcm1hbmNlXG4gIGRiLmV4ZWMoYFxuICAgIENSRUFURSBJTkRFWCBJRiBOT1QgRVhJU1RTIGlkeF91c2Vyc19lbWFpbCBPTiB1c2VycyhlbWFpbCk7XG4gICAgQ1JFQVRFIElOREVYIElGIE5PVCBFWElTVFMgaWR4X3JlZnJlc2hfdG9rZW5zX3VzZXJfaWQgT04gcmVmcmVzaF90b2tlbnModXNlcl9pZCk7XG4gICAgQ1JFQVRFIElOREVYIElGIE5PVCBFWElTVFMgaWR4X3JlZnJlc2hfdG9rZW5zX2V4cGlyZXNfYXQgT04gcmVmcmVzaF90b2tlbnMoZXhwaXJlc19hdCk7XG4gICAgQ1JFQVRFIElOREVYIElGIE5PVCBFWElTVFMgaWR4X3JhdGVfbGltaXRzX3dpbmRvd19zdGFydCBPTiByYXRlX2xpbWl0cyh3aW5kb3dfc3RhcnQpO1xuICBgKTtcblxuICBjb25zb2xlLmxvZygnRGF0YWJhc2UgdGFibGVzIGNyZWF0ZWQgc3VjY2Vzc2Z1bGx5Jyk7XG59XG5cbi8vIERhdGFiYXNlIG9wZXJhdGlvbnNcbmV4cG9ydCBjbGFzcyBEYXRhYmFzZU9wZXJhdGlvbnMge1xuICBwcml2YXRlIGRiOiBEYXRhYmFzZS5EYXRhYmFzZTtcblxuICBjb25zdHJ1Y3RvcigpIHtcbiAgICB0aGlzLmRiID0gaW5pdERhdGFiYXNlKCk7XG4gICAgY3JlYXRlVGFibGVzKCk7IC8vIEVuc3VyZSB0YWJsZXMgYXJlIGNyZWF0ZWRcbiAgfVxuXG4gIC8vIFVzZXIgb3BlcmF0aW9uc1xuICBhc3luYyBjcmVhdGVVc2VyKHVzZXJEYXRhOiBPbWl0PFVzZXIsICdpZCcgfCAnY3JlYXRlZEF0JyB8ICd1cGRhdGVkQXQnPik6IFByb21pc2U8VXNlcj4ge1xuICAgIGNvbnN0IGlkID0gYHVzZXJfJHtEYXRlLm5vdygpfV8ke01hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cigyLCA5KX1gO1xuICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKTtcblxuICAgIGNvbnN0IHN0bXQgPSB0aGlzLmRiLnByZXBhcmUoYFxuICAgICAgSU5TRVJUIElOVE8gdXNlcnMgKFxuICAgICAgICBpZCwgZW1haWwsIHBhc3N3b3JkX2hhc2gsIG5hbWUsIHJlc3RhdXJhbnRfbmFtZSwgY3Vpc2luZV90eXBlLFxuICAgICAgICBsb2NhdGlvbiwgcGhvbmUsIHJvbGUsIHN1YnNjcmlwdGlvbl9zdGF0dXMsIHRyaWFsX3N0YXJ0X2RhdGUsXG4gICAgICAgIHRyaWFsX2VuZF9kYXRlLCBzdHJpcGVfY3VzdG9tZXJfaWQsIHN0cmlwZV9zdWJzY3JpcHRpb25faWQsXG4gICAgICAgIG1hcmtldGluZ19jb25zZW50LCBlbWFpbF92ZXJpZmllZCwgb25ib2FyZGluZ19jb21wbGV0ZWQsXG4gICAgICAgIGNyZWF0ZWRfYXQsIHVwZGF0ZWRfYXRcbiAgICAgICkgVkFMVUVTICg/LCA/LCA/LCA/LCA/LCA/LCA/LCA/LCA/LCA/LCA/LCA/LCA/LCA/LCA/LCA/LCA/LCA/LCA/KVxuICAgIGApO1xuXG4gICAgdHJ5IHtcbiAgICAgIHN0bXQucnVuKFxuICAgICAgICBpZCwgdXNlckRhdGEuZW1haWwsIHVzZXJEYXRhLnBhc3N3b3JkSGFzaCwgdXNlckRhdGEubmFtZSxcbiAgICAgICAgdXNlckRhdGEucmVzdGF1cmFudE5hbWUsIHVzZXJEYXRhLmN1aXNpbmVUeXBlIHx8ICcnLCB1c2VyRGF0YS5sb2NhdGlvbiB8fCAnJyxcbiAgICAgICAgdXNlckRhdGEucGhvbmUgfHwgJycsIHVzZXJEYXRhLnJvbGUgfHwgJ3VzZXInLCB1c2VyRGF0YS5zdWJzY3JpcHRpb25TdGF0dXMgfHwgJ3RyaWFsaW5nJyxcbiAgICAgICAgdXNlckRhdGEudHJpYWxTdGFydERhdGUsIHVzZXJEYXRhLnRyaWFsRW5kRGF0ZSwgdXNlckRhdGEuc3RyaXBlQ3VzdG9tZXJJZCxcbiAgICAgICAgdXNlckRhdGEuc3RyaXBlU3Vic2NyaXB0aW9uSWQsIHVzZXJEYXRhLm1hcmtldGluZ0NvbnNlbnQgPyAxIDogMCxcbiAgICAgICAgdXNlckRhdGEuZW1haWxWZXJpZmllZCA/IDEgOiAwLCB1c2VyRGF0YS5vbmJvYXJkaW5nQ29tcGxldGVkID8gMSA6IDAsXG4gICAgICAgIG5vdywgbm93XG4gICAgICApO1xuXG4gICAgICByZXR1cm4gdGhpcy5nZXRVc2VyQnlJZChpZCkhO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBpZiAoKGVycm9yIGFzIGFueSkuY29kZSA9PT0gJ1NRTElURV9DT05TVFJBSU5UX1VOSVFVRScpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdVc2VyIHdpdGggdGhpcyBlbWFpbCBhbHJlYWR5IGV4aXN0cycpO1xuICAgICAgfVxuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG5cbiAgZ2V0VXNlckJ5RW1haWwoZW1haWw6IHN0cmluZyk6IFVzZXIgfCBudWxsIHtcbiAgICBjb25zdCBzdG10ID0gdGhpcy5kYi5wcmVwYXJlKCdTRUxFQ1QgKiBGUk9NIHVzZXJzIFdIRVJFIGVtYWlsID0gPyBMSU1JVCAxJyk7XG4gICAgY29uc3Qgcm93ID0gc3RtdC5nZXQoZW1haWwpO1xuICAgIHJldHVybiByb3cgPyB0aGlzLm1hcFJvd1RvVXNlcihyb3cpIDogbnVsbDtcbiAgfVxuXG4gIGdldFVzZXJCeUlkKGlkOiBzdHJpbmcpOiBVc2VyIHwgbnVsbCB7XG4gICAgY29uc3Qgc3RtdCA9IHRoaXMuZGIucHJlcGFyZSgnU0VMRUNUICogRlJPTSB1c2VycyBXSEVSRSBpZCA9ID8gTElNSVQgMScpO1xuICAgIGNvbnN0IHJvdyA9IHN0bXQuZ2V0KGlkKTtcbiAgICByZXR1cm4gcm93ID8gdGhpcy5tYXBSb3dUb1VzZXIocm93KSA6IG51bGw7XG4gIH1cblxuICB1cGRhdGVVc2VyKGlkOiBzdHJpbmcsIHVwZGF0ZXM6IFBhcnRpYWw8VXNlcj4pOiBVc2VyIHwgbnVsbCB7XG4gICAgY29uc3QgdXBkYXRlRmllbGRzID0gT2JqZWN0LmtleXModXBkYXRlcylcbiAgICAgIC5maWx0ZXIoa2V5ID0+IGtleSAhPT0gJ2lkJyAmJiBrZXkgIT09ICdjcmVhdGVkQXQnKVxuICAgICAgLm1hcChrZXkgPT4gYCR7dGhpcy5jYW1lbFRvU25ha2Uoa2V5KX0gPSA/YClcbiAgICAgIC5qb2luKCcsICcpO1xuXG4gICAgaWYgKCF1cGRhdGVGaWVsZHMpIHJldHVybiB0aGlzLmdldFVzZXJCeUlkKGlkKTtcblxuICAgIGNvbnN0IHZhbHVlcyA9IE9iamVjdC5rZXlzKHVwZGF0ZXMpXG4gICAgICAuZmlsdGVyKGtleSA9PiBrZXkgIT09ICdpZCcgJiYga2V5ICE9PSAnY3JlYXRlZEF0JylcbiAgICAgIC5tYXAoa2V5ID0+ICh1cGRhdGVzIGFzIGFueSlba2V5XSk7XG5cbiAgICBjb25zdCBzdG10ID0gdGhpcy5kYi5wcmVwYXJlKGBcbiAgICAgIFVQREFURSB1c2VycyBcbiAgICAgIFNFVCAke3VwZGF0ZUZpZWxkc30sIHVwZGF0ZWRfYXQgPSA/XG4gICAgICBXSEVSRSBpZCA9ID9cbiAgICBgKTtcblxuICAgIHN0bXQucnVuKC4uLnZhbHVlcywgbmV3IERhdGUoKS50b0lTT1N0cmluZygpLCBpZCk7XG4gICAgcmV0dXJuIHRoaXMuZ2V0VXNlckJ5SWQoaWQpO1xuICB9XG5cbiAgdXBkYXRlTGFzdExvZ2luKGlkOiBzdHJpbmcpOiB2b2lkIHtcbiAgICBjb25zdCBzdG10ID0gdGhpcy5kYi5wcmVwYXJlKCdVUERBVEUgdXNlcnMgU0VUIGxhc3RfbG9naW5fYXQgPSA/IFdIRVJFIGlkID0gPycpO1xuICAgIHN0bXQucnVuKG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSwgaWQpO1xuICB9XG5cbiAgLy8gUmVmcmVzaCB0b2tlbiBvcGVyYXRpb25zXG4gIGNyZWF0ZVJlZnJlc2hUb2tlbih1c2VySWQ6IHN0cmluZywgdG9rZW5IYXNoOiBzdHJpbmcsIGV4cGlyZXNBdDogRGF0ZSk6IHN0cmluZyB7XG4gICAgY29uc3QgaWQgPSBgcnRfJHtEYXRlLm5vdygpfV8ke01hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cigyLCA5KX1gO1xuICAgIGNvbnN0IHN0bXQgPSB0aGlzLmRiLnByZXBhcmUoYFxuICAgICAgSU5TRVJUIElOVE8gcmVmcmVzaF90b2tlbnMgKGlkLCB1c2VyX2lkLCB0b2tlbl9oYXNoLCBleHBpcmVzX2F0LCBjcmVhdGVkX2F0KVxuICAgICAgVkFMVUVTICg/LCA/LCA/LCA/LCA/KVxuICAgIGApO1xuXG4gICAgc3RtdC5ydW4oaWQsIHVzZXJJZCwgdG9rZW5IYXNoLCBleHBpcmVzQXQudG9JU09TdHJpbmcoKSwgbmV3IERhdGUoKS50b0lTT1N0cmluZygpKTtcbiAgICByZXR1cm4gaWQ7XG4gIH1cblxuICBnZXRSZWZyZXNoVG9rZW4odG9rZW5IYXNoOiBzdHJpbmcpOiBSZWZyZXNoVG9rZW4gfCBudWxsIHtcbiAgICBjb25zdCBzdG10ID0gdGhpcy5kYi5wcmVwYXJlKGBcbiAgICAgIFNFTEVDVCAqIEZST00gcmVmcmVzaF90b2tlbnMgXG4gICAgICBXSEVSRSB0b2tlbl9oYXNoID0gPyBBTkQgcmV2b2tlZCA9IGZhbHNlIEFORCBleHBpcmVzX2F0ID4gZGF0ZXRpbWUoJ25vdycpXG4gICAgICBMSU1JVCAxXG4gICAgYCk7XG4gICAgY29uc3Qgcm93ID0gc3RtdC5nZXQodG9rZW5IYXNoKSBhcyBhbnk7XG4gICAgXG4gICAgaWYgKCFyb3cpIHJldHVybiBudWxsO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIGlkOiByb3cuaWQsXG4gICAgICB1c2VySWQ6IHJvdy51c2VyX2lkLFxuICAgICAgdG9rZW5IYXNoOiByb3cudG9rZW5faGFzaCxcbiAgICAgIGV4cGlyZXNBdDogbmV3IERhdGUocm93LmV4cGlyZXNfYXQpLFxuICAgICAgY3JlYXRlZEF0OiBuZXcgRGF0ZShyb3cuY3JlYXRlZF9hdCksXG4gICAgICByZXZva2VkOiBCb29sZWFuKHJvdy5yZXZva2VkKVxuICAgIH07XG4gIH1cblxuICByZXZva2VSZWZyZXNoVG9rZW4odG9rZW5IYXNoOiBzdHJpbmcpOiB2b2lkIHtcbiAgICBjb25zdCBzdG10ID0gdGhpcy5kYi5wcmVwYXJlKCdVUERBVEUgcmVmcmVzaF90b2tlbnMgU0VUIHJldm9rZWQgPSB0cnVlIFdIRVJFIHRva2VuX2hhc2ggPSA/Jyk7XG4gICAgc3RtdC5ydW4odG9rZW5IYXNoKTtcbiAgfVxuXG4gIHJldm9rZUFsbFVzZXJSZWZyZXNoVG9rZW5zKHVzZXJJZDogc3RyaW5nKTogdm9pZCB7XG4gICAgY29uc3Qgc3RtdCA9IHRoaXMuZGIucHJlcGFyZSgnVVBEQVRFIHJlZnJlc2hfdG9rZW5zIFNFVCByZXZva2VkID0gdHJ1ZSBXSEVSRSB1c2VyX2lkID0gPycpO1xuICAgIHN0bXQucnVuKHVzZXJJZCk7XG4gIH1cblxuICAvLyBDbGVhbiB1cCBleHBpcmVkIHRva2Vuc1xuICBjbGVhbnVwRXhwaXJlZFRva2VucygpOiB2b2lkIHtcbiAgICBjb25zdCBzdG10ID0gdGhpcy5kYi5wcmVwYXJlKFwiREVMRVRFIEZST00gcmVmcmVzaF90b2tlbnMgV0hFUkUgZXhwaXJlc19hdCA8IGRhdGV0aW1lKCdub3cnKVwiKTtcbiAgICBjb25zdCByZXN1bHQgPSBzdG10LnJ1bigpO1xuICAgIGlmIChyZXN1bHQuY2hhbmdlcyA+IDApIHtcbiAgICAgIGNvbnNvbGUubG9nKGBDbGVhbmVkIHVwICR7cmVzdWx0LmNoYW5nZXN9IGV4cGlyZWQgcmVmcmVzaCB0b2tlbnNgKTtcbiAgICB9XG4gIH1cblxuICAvLyBSYXRlIGxpbWl0aW5nIG9wZXJhdGlvbnNcbiAgZ2V0UmF0ZUxpbWl0KGtleTogc3RyaW5nKTogeyByZXF1ZXN0czogbnVtYmVyOyB3aW5kb3dTdGFydDogRGF0ZSB9IHwgbnVsbCB7XG4gICAgY29uc3Qgc3RtdCA9IHRoaXMuZGIucHJlcGFyZSgnU0VMRUNUICogRlJPTSByYXRlX2xpbWl0cyBXSEVSRSBrZXkgPSA/IExJTUlUIDEnKTtcbiAgICBjb25zdCByb3cgPSBzdG10LmdldChrZXkpIGFzIGFueTtcbiAgICBcbiAgICBpZiAoIXJvdykgcmV0dXJuIG51bGw7XG5cbiAgICByZXR1cm4ge1xuICAgICAgcmVxdWVzdHM6IHJvdy5yZXF1ZXN0cyxcbiAgICAgIHdpbmRvd1N0YXJ0OiBuZXcgRGF0ZShyb3cud2luZG93X3N0YXJ0KVxuICAgIH07XG4gIH1cblxuICB1cGRhdGVSYXRlTGltaXQoa2V5OiBzdHJpbmcsIHJlcXVlc3RzOiBudW1iZXIsIHdpbmRvd1N0YXJ0OiBEYXRlKTogdm9pZCB7XG4gICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpO1xuICAgIGNvbnN0IHN0bXQgPSB0aGlzLmRiLnByZXBhcmUoYFxuICAgICAgSU5TRVJUIE9SIFJFUExBQ0UgSU5UTyByYXRlX2xpbWl0cyAoa2V5LCByZXF1ZXN0cywgd2luZG93X3N0YXJ0LCBjcmVhdGVkX2F0LCB1cGRhdGVkX2F0KVxuICAgICAgVkFMVUVTICg/LCA/LCA/LCBDT0FMRVNDRSgoU0VMRUNUIGNyZWF0ZWRfYXQgRlJPTSByYXRlX2xpbWl0cyBXSEVSRSBrZXkgPSA/KSwgPyksID8pXG4gICAgYCk7XG4gICAgXG4gICAgc3RtdC5ydW4oa2V5LCByZXF1ZXN0cywgd2luZG93U3RhcnQudG9JU09TdHJpbmcoKSwga2V5LCBub3csIG5vdyk7XG4gIH1cblxuICAvLyBVdGlsaXR5IG1ldGhvZHNcbiAgcHJpdmF0ZSBtYXBSb3dUb1VzZXIocm93OiBhbnkpOiBVc2VyIHtcbiAgICByZXR1cm4ge1xuICAgICAgaWQ6IHJvdy5pZCxcbiAgICAgIGVtYWlsOiByb3cuZW1haWwsXG4gICAgICBwYXNzd29yZEhhc2g6IHJvdy5wYXNzd29yZF9oYXNoLFxuICAgICAgbmFtZTogcm93Lm5hbWUsXG4gICAgICByZXN0YXVyYW50TmFtZTogcm93LnJlc3RhdXJhbnRfbmFtZSxcbiAgICAgIGN1aXNpbmVUeXBlOiByb3cuY3Vpc2luZV90eXBlLFxuICAgICAgbG9jYXRpb246IHJvdy5sb2NhdGlvbixcbiAgICAgIHBob25lOiByb3cucGhvbmUsXG4gICAgICByb2xlOiByb3cucm9sZSxcbiAgICAgIHN1YnNjcmlwdGlvblN0YXR1czogcm93LnN1YnNjcmlwdGlvbl9zdGF0dXMsXG4gICAgICB0cmlhbFN0YXJ0RGF0ZTogcm93LnRyaWFsX3N0YXJ0X2RhdGUsXG4gICAgICB0cmlhbEVuZERhdGU6IHJvdy50cmlhbF9lbmRfZGF0ZSxcbiAgICAgIHN0cmlwZUN1c3RvbWVySWQ6IHJvdy5zdHJpcGVfY3VzdG9tZXJfaWQsXG4gICAgICBzdHJpcGVTdWJzY3JpcHRpb25JZDogcm93LnN0cmlwZV9zdWJzY3JpcHRpb25faWQsXG4gICAgICBtYXJrZXRpbmdDb25zZW50OiBCb29sZWFuKHJvdy5tYXJrZXRpbmdfY29uc2VudCksXG4gICAgICBlbWFpbFZlcmlmaWVkOiBCb29sZWFuKHJvdy5lbWFpbF92ZXJpZmllZCksXG4gICAgICBvbmJvYXJkaW5nQ29tcGxldGVkOiBCb29sZWFuKHJvdy5vbmJvYXJkaW5nX2NvbXBsZXRlZCksXG4gICAgICBjcmVhdGVkQXQ6IHJvdy5jcmVhdGVkX2F0LFxuICAgICAgdXBkYXRlZEF0OiByb3cudXBkYXRlZF9hdCxcbiAgICAgIGxhc3RMb2dpbkF0OiByb3cubGFzdF9sb2dpbl9hdFxuICAgIH07XG4gIH1cblxuICBwcml2YXRlIGNhbWVsVG9TbmFrZShzdHI6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgcmV0dXJuIHN0ci5yZXBsYWNlKC9bQS1aXS9nLCBsZXR0ZXIgPT4gYF8ke2xldHRlci50b0xvd2VyQ2FzZSgpfWApO1xuICB9XG5cbiAgLy8gSGVhbHRoIGNoZWNrXG4gIGhlYWx0aENoZWNrKCk6IGJvb2xlYW4ge1xuICAgIHRyeSB7XG4gICAgICB0aGlzLmRiLnByZXBhcmUoJ1NFTEVDVCAxJykuZ2V0KCk7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRGF0YWJhc2UgaGVhbHRoIGNoZWNrIGZhaWxlZDonLCBlcnJvcik7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG5cbiAgLy8gQ2xvc2UgZGF0YWJhc2UgY29ubmVjdGlvblxuICBjbG9zZSgpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5kYikge1xuICAgICAgdGhpcy5kYi5jbG9zZSgpO1xuICAgIH1cbiAgfVxufVxuXG4vLyBTaW5nbGV0b24gaW5zdGFuY2VcbmV4cG9ydCBjb25zdCBkYXRhYmFzZSA9IG5ldyBEYXRhYmFzZU9wZXJhdGlvbnMoKTsgIl0sIm5hbWVzIjpbIkRhdGFiYXNlIiwicGF0aCIsImRiIiwiaW5pdERhdGFiYXNlIiwiZGJQYXRoIiwiam9pbiIsInByb2Nlc3MiLCJjd2QiLCJmcyIsInJlcXVpcmUiLCJkYXRhRGlyIiwiZGlybmFtZSIsImV4aXN0c1N5bmMiLCJta2RpclN5bmMiLCJyZWN1cnNpdmUiLCJwcmFnbWEiLCJjcmVhdGVUYWJsZXMiLCJjb25zb2xlIiwibG9nIiwiZXJyb3IiLCJleGVjIiwiRGF0YWJhc2VPcGVyYXRpb25zIiwiY29uc3RydWN0b3IiLCJjcmVhdGVVc2VyIiwidXNlckRhdGEiLCJpZCIsIkRhdGUiLCJub3ciLCJNYXRoIiwicmFuZG9tIiwidG9TdHJpbmciLCJzdWJzdHIiLCJ0b0lTT1N0cmluZyIsInN0bXQiLCJwcmVwYXJlIiwicnVuIiwiZW1haWwiLCJwYXNzd29yZEhhc2giLCJuYW1lIiwicmVzdGF1cmFudE5hbWUiLCJjdWlzaW5lVHlwZSIsImxvY2F0aW9uIiwicGhvbmUiLCJyb2xlIiwic3Vic2NyaXB0aW9uU3RhdHVzIiwidHJpYWxTdGFydERhdGUiLCJ0cmlhbEVuZERhdGUiLCJzdHJpcGVDdXN0b21lcklkIiwic3RyaXBlU3Vic2NyaXB0aW9uSWQiLCJtYXJrZXRpbmdDb25zZW50IiwiZW1haWxWZXJpZmllZCIsIm9uYm9hcmRpbmdDb21wbGV0ZWQiLCJnZXRVc2VyQnlJZCIsImNvZGUiLCJFcnJvciIsImdldFVzZXJCeUVtYWlsIiwicm93IiwiZ2V0IiwibWFwUm93VG9Vc2VyIiwidXBkYXRlVXNlciIsInVwZGF0ZXMiLCJ1cGRhdGVGaWVsZHMiLCJPYmplY3QiLCJrZXlzIiwiZmlsdGVyIiwia2V5IiwibWFwIiwiY2FtZWxUb1NuYWtlIiwidmFsdWVzIiwidXBkYXRlTGFzdExvZ2luIiwiY3JlYXRlUmVmcmVzaFRva2VuIiwidXNlcklkIiwidG9rZW5IYXNoIiwiZXhwaXJlc0F0IiwiZ2V0UmVmcmVzaFRva2VuIiwidXNlcl9pZCIsInRva2VuX2hhc2giLCJleHBpcmVzX2F0IiwiY3JlYXRlZEF0IiwiY3JlYXRlZF9hdCIsInJldm9rZWQiLCJCb29sZWFuIiwicmV2b2tlUmVmcmVzaFRva2VuIiwicmV2b2tlQWxsVXNlclJlZnJlc2hUb2tlbnMiLCJjbGVhbnVwRXhwaXJlZFRva2VucyIsInJlc3VsdCIsImNoYW5nZXMiLCJnZXRSYXRlTGltaXQiLCJyZXF1ZXN0cyIsIndpbmRvd1N0YXJ0Iiwid2luZG93X3N0YXJ0IiwidXBkYXRlUmF0ZUxpbWl0IiwicGFzc3dvcmRfaGFzaCIsInJlc3RhdXJhbnRfbmFtZSIsImN1aXNpbmVfdHlwZSIsInN1YnNjcmlwdGlvbl9zdGF0dXMiLCJ0cmlhbF9zdGFydF9kYXRlIiwidHJpYWxfZW5kX2RhdGUiLCJzdHJpcGVfY3VzdG9tZXJfaWQiLCJzdHJpcGVfc3Vic2NyaXB0aW9uX2lkIiwibWFya2V0aW5nX2NvbnNlbnQiLCJlbWFpbF92ZXJpZmllZCIsIm9uYm9hcmRpbmdfY29tcGxldGVkIiwidXBkYXRlZEF0IiwidXBkYXRlZF9hdCIsImxhc3RMb2dpbkF0IiwibGFzdF9sb2dpbl9hdCIsInN0ciIsInJlcGxhY2UiLCJsZXR0ZXIiLCJ0b0xvd2VyQ2FzZSIsImhlYWx0aENoZWNrIiwiY2xvc2UiLCJkYXRhYmFzZSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/database.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/validation.ts":
/*!*******************************!*\
  !*** ./src/lib/validation.ts ***!
  \*******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   ERROR_MESSAGES: () => (/* binding */ ERROR_MESSAGES),\n/* harmony export */   authRequestSchema: () => (/* binding */ authRequestSchema),\n/* harmony export */   cuisineTypeSchema: () => (/* binding */ cuisineTypeSchema),\n/* harmony export */   emailSchema: () => (/* binding */ emailSchema),\n/* harmony export */   getPasswordStrength: () => (/* binding */ getPasswordStrength),\n/* harmony export */   idSchema: () => (/* binding */ idSchema),\n/* harmony export */   locationSchema: () => (/* binding */ locationSchema),\n/* harmony export */   loginRequestSchema: () => (/* binding */ loginRequestSchema),\n/* harmony export */   nameSchema: () => (/* binding */ nameSchema),\n/* harmony export */   paginationSchema: () => (/* binding */ paginationSchema),\n/* harmony export */   passwordSchema: () => (/* binding */ passwordSchema),\n/* harmony export */   phoneSchema: () => (/* binding */ phoneSchema),\n/* harmony export */   rateLimitKeySchema: () => (/* binding */ rateLimitKeySchema),\n/* harmony export */   refreshTokenRequestSchema: () => (/* binding */ refreshTokenRequestSchema),\n/* harmony export */   registerRequestSchema: () => (/* binding */ registerRequestSchema),\n/* harmony export */   restaurantNameSchema: () => (/* binding */ restaurantNameSchema),\n/* harmony export */   roleSchema: () => (/* binding */ roleSchema),\n/* harmony export */   sanitizeEmail: () => (/* binding */ sanitizeEmail),\n/* harmony export */   sanitizeString: () => (/* binding */ sanitizeString),\n/* harmony export */   subscriptionStatusSchema: () => (/* binding */ subscriptionStatusSchema),\n/* harmony export */   userIdSchema: () => (/* binding */ userIdSchema),\n/* harmony export */   userProfileUpdateSchema: () => (/* binding */ userProfileUpdateSchema),\n/* harmony export */   validateInput: () => (/* binding */ validateInput)\n/* harmony export */ });\n/* harmony import */ var zod__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! zod */ \"(rsc)/./node_modules/zod/dist/esm/index.js\");\n\n// Email validation schema\nconst emailSchema = zod__WEBPACK_IMPORTED_MODULE_0__.z.string().email(\"Invalid email format\").min(1, \"Email is required\").max(255, \"Email is too long\");\n// Password validation schema\nconst passwordSchema = zod__WEBPACK_IMPORTED_MODULE_0__.z.string().min(8, \"Password must be at least 8 characters\").max(128, \"Password is too long\").regex(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\\d)/, \"Password must contain at least one lowercase letter, one uppercase letter, and one number\");\n// Name validation schema  \nconst nameSchema = zod__WEBPACK_IMPORTED_MODULE_0__.z.string().min(1, \"Name is required\").max(100, \"Name is too long\").regex(/^[a-zA-Z\\s\\-']+$/, \"Name can only contain letters, spaces, hyphens, and apostrophes\");\n// Restaurant name validation schema\nconst restaurantNameSchema = zod__WEBPACK_IMPORTED_MODULE_0__.z.string().min(1, \"Restaurant name is required\").max(100, \"Restaurant name is too long\");\n// Phone validation schema (optional)\nconst phoneSchema = zod__WEBPACK_IMPORTED_MODULE_0__.z.string().optional().refine((phone)=>{\n    if (!phone) return true; // Optional field\n    return /^\\+?[\\d\\s\\-\\(\\)]+$/.test(phone) && phone.replace(/\\D/g, \"\").length >= 7;\n}, \"Invalid phone number format\");\n// Location validation schema (optional)\nconst locationSchema = zod__WEBPACK_IMPORTED_MODULE_0__.z.string().max(200, \"Location is too long\").optional();\n// Cuisine type validation schema (optional)\nconst cuisineTypeSchema = zod__WEBPACK_IMPORTED_MODULE_0__.z.string().max(50, \"Cuisine type is too long\").optional();\n// Login request validation\nconst loginRequestSchema = zod__WEBPACK_IMPORTED_MODULE_0__.z.object({\n    action: zod__WEBPACK_IMPORTED_MODULE_0__.z.literal(\"login\"),\n    email: emailSchema,\n    password: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().min(1, \"Password is required\")\n});\n// Registration request validation\nconst registerRequestSchema = zod__WEBPACK_IMPORTED_MODULE_0__.z.object({\n    action: zod__WEBPACK_IMPORTED_MODULE_0__.z.literal(\"register\"),\n    email: emailSchema,\n    password: passwordSchema,\n    name: nameSchema,\n    restaurantName: restaurantNameSchema,\n    cuisineType: cuisineTypeSchema,\n    location: locationSchema,\n    phone: phoneSchema,\n    marketingConsent: zod__WEBPACK_IMPORTED_MODULE_0__.z.boolean().optional().default(false)\n});\n// Auth request validation (union of login and register)\nconst authRequestSchema = zod__WEBPACK_IMPORTED_MODULE_0__.z.discriminatedUnion(\"action\", [\n    loginRequestSchema,\n    registerRequestSchema\n]);\n// Refresh token request validation\nconst refreshTokenRequestSchema = zod__WEBPACK_IMPORTED_MODULE_0__.z.object({\n    refreshToken: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().min(1, \"Refresh token is required\")\n});\n// User profile update validation\nconst userProfileUpdateSchema = zod__WEBPACK_IMPORTED_MODULE_0__.z.object({\n    name: nameSchema.optional(),\n    restaurantName: restaurantNameSchema.optional(),\n    cuisineType: cuisineTypeSchema,\n    location: locationSchema,\n    phone: phoneSchema,\n    marketingConsent: zod__WEBPACK_IMPORTED_MODULE_0__.z.boolean().optional()\n}).refine((data)=>Object.values(data).some((value)=>value !== undefined), {\n    message: \"At least one field must be provided for update\"\n});\n// User ID validation\nconst userIdSchema = zod__WEBPACK_IMPORTED_MODULE_0__.z.string().min(1, \"User ID is required\").regex(/^user_\\d+_[a-zA-Z0-9]+$/, \"Invalid user ID format\");\n// Role validation\nconst roleSchema = zod__WEBPACK_IMPORTED_MODULE_0__.z[\"enum\"]([\n    \"user\",\n    \"admin\",\n    \"moderator\"\n]);\n// Subscription status validation\nconst subscriptionStatusSchema = zod__WEBPACK_IMPORTED_MODULE_0__.z[\"enum\"]([\n    \"trialing\",\n    \"active\",\n    \"past_due\",\n    \"canceled\",\n    \"unpaid\"\n]);\n// Pagination validation\nconst paginationSchema = zod__WEBPACK_IMPORTED_MODULE_0__.z.object({\n    page: zod__WEBPACK_IMPORTED_MODULE_0__.z.coerce.number().int().min(1).default(1),\n    limit: zod__WEBPACK_IMPORTED_MODULE_0__.z.coerce.number().int().min(1).max(100).default(10)\n});\n// Rate limiting validation helpers\nconst rateLimitKeySchema = zod__WEBPACK_IMPORTED_MODULE_0__.z.string().min(1).max(255);\n// Generic ID validation\nconst idSchema = zod__WEBPACK_IMPORTED_MODULE_0__.z.string().min(1, \"ID is required\");\n// Validation utility functions\nfunction validateInput(schema, data) {\n    try {\n        const validatedData = schema.parse(data);\n        return {\n            success: true,\n            data: validatedData\n        };\n    } catch (error) {\n        if (error instanceof zod__WEBPACK_IMPORTED_MODULE_0__.z.ZodError) {\n            const errors = {};\n            error.errors.forEach((err)=>{\n                const path = err.path.join(\".\");\n                errors[path] = err.message;\n            });\n            return {\n                success: false,\n                errors\n            };\n        }\n        return {\n            success: false,\n            errors: {\n                general: \"Validation failed\"\n            }\n        };\n    }\n}\n// Sanitization helpers\nfunction sanitizeString(input) {\n    if (!input) return \"\";\n    return input.trim().replace(/\\s+/g, \" \");\n}\nfunction sanitizeEmail(email) {\n    return email.toLowerCase().trim();\n}\n// Password strength validation\nfunction getPasswordStrength(password) {\n    const feedback = [];\n    let score = 0;\n    if (password.length >= 8) score += 1;\n    else feedback.push(\"Use at least 8 characters\");\n    if (/[a-z]/.test(password)) score += 1;\n    else feedback.push(\"Include lowercase letters\");\n    if (/[A-Z]/.test(password)) score += 1;\n    else feedback.push(\"Include uppercase letters\");\n    if (/\\d/.test(password)) score += 1;\n    else feedback.push(\"Include numbers\");\n    if (/[^a-zA-Z0-9]/.test(password)) score += 1;\n    else feedback.push(\"Include special characters\");\n    if (password.length >= 12) score += 1;\n    return {\n        score,\n        feedback\n    };\n}\n// Common error messages\nconst ERROR_MESSAGES = {\n    REQUIRED_FIELD: \"This field is required\",\n    INVALID_EMAIL: \"Please enter a valid email address\",\n    WEAK_PASSWORD: \"Password does not meet security requirements\",\n    INVALID_PHONE: \"Please enter a valid phone number\",\n    MAX_LENGTH_EXCEEDED: \"Input is too long\",\n    INVALID_FORMAT: \"Invalid format\",\n    USER_EXISTS: \"A user with this email already exists\",\n    USER_NOT_FOUND: \"User not found\",\n    INVALID_CREDENTIALS: \"Invalid email or password\",\n    UNAUTHORIZED: \"You are not authorized to perform this action\",\n    RATE_LIMIT_EXCEEDED: \"Too many requests. Please try again later.\",\n    INTERNAL_ERROR: \"An internal error occurred. Please try again.\"\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QWdCO0FBQ2xCLEVBQVciLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9jaGVmc29jaWFsLW5leHQvLi9zcmMvbGliL3ZhbGlkYXRpb24udHM/NDYwZiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyB6IH0gZnJvbSAnem9kJztcblxuLy8gRW1haWwgdmFsaWRhdGlvbiBzY2hlbWFcbmV4cG9ydCBjb25zdCBlbWFpbFNjaGVtYSA9IHpcbiAgLnN0cmluZygpXG4gIC5lbWFpbCgnSW52YWxpZCBlbWFpbCBmb3JtYXQnKVxuICAubWluKDEsICdFbWFpbCBpcyByZXF1aXJlZCcpXG4gIC5tYXgoMjU1LCAnRW1haWwgaXMgdG9vIGxvbmcnKTtcblxuLy8gUGFzc3dvcmQgdmFsaWRhdGlvbiBzY2hlbWFcbmV4cG9ydCBjb25zdCBwYXNzd29yZFNjaGVtYSA9IHpcbiAgLnN0cmluZygpXG4gIC5taW4oOCwgJ1Bhc3N3b3JkIG11c3QgYmUgYXQgbGVhc3QgOCBjaGFyYWN0ZXJzJylcbiAgLm1heCgxMjgsICdQYXNzd29yZCBpcyB0b28gbG9uZycpXG4gIC5yZWdleCgvXig/PS4qW2Etel0pKD89LipbQS1aXSkoPz0uKlxcZCkvLCBcbiAgICAnUGFzc3dvcmQgbXVzdCBjb250YWluIGF0IGxlYXN0IG9uZSBsb3dlcmNhc2UgbGV0dGVyLCBvbmUgdXBwZXJjYXNlIGxldHRlciwgYW5kIG9uZSBudW1iZXInKTtcblxuLy8gTmFtZSB2YWxpZGF0aW9uIHNjaGVtYSAgXG5leHBvcnQgY29uc3QgbmFtZVNjaGVtYSA9IHpcbiAgLnN0cmluZygpXG4gIC5taW4oMSwgJ05hbWUgaXMgcmVxdWlyZWQnKVxuICAubWF4KDEwMCwgJ05hbWUgaXMgdG9vIGxvbmcnKVxuICAucmVnZXgoL15bYS16QS1aXFxzXFwtJ10rJC8sICdOYW1lIGNhbiBvbmx5IGNvbnRhaW4gbGV0dGVycywgc3BhY2VzLCBoeXBoZW5zLCBhbmQgYXBvc3Ryb3BoZXMnKTtcblxuLy8gUmVzdGF1cmFudCBuYW1lIHZhbGlkYXRpb24gc2NoZW1hXG5leHBvcnQgY29uc3QgcmVzdGF1cmFudE5hbWVTY2hlbWEgPSB6XG4gIC5zdHJpbmcoKVxuICAubWluKDEsICdSZXN0YXVyYW50IG5hbWUgaXMgcmVxdWlyZWQnKVxuICAubWF4KDEwMCwgJ1Jlc3RhdXJhbnQgbmFtZSBpcyB0b28gbG9uZycpO1xuXG4vLyBQaG9uZSB2YWxpZGF0aW9uIHNjaGVtYSAob3B0aW9uYWwpXG5leHBvcnQgY29uc3QgcGhvbmVTY2hlbWEgPSB6XG4gIC5zdHJpbmcoKVxuICAub3B0aW9uYWwoKVxuICAucmVmaW5lKChwaG9uZTogc3RyaW5nIHwgdW5kZWZpbmVkKSA9PiB7XG4gICAgaWYgKCFwaG9uZSkgcmV0dXJuIHRydWU7IC8vIE9wdGlvbmFsIGZpZWxkXG4gICAgcmV0dXJuIC9eXFwrP1tcXGRcXHNcXC1cXChcXCldKyQvLnRlc3QocGhvbmUpICYmIHBob25lLnJlcGxhY2UoL1xcRC9nLCAnJykubGVuZ3RoID49IDc7XG4gIH0sICdJbnZhbGlkIHBob25lIG51bWJlciBmb3JtYXQnKTtcblxuLy8gTG9jYXRpb24gdmFsaWRhdGlvbiBzY2hlbWEgKG9wdGlvbmFsKVxuZXhwb3J0IGNvbnN0IGxvY2F0aW9uU2NoZW1hID0gelxuICAuc3RyaW5nKClcbiAgLm1heCgyMDAsICdMb2NhdGlvbiBpcyB0b28gbG9uZycpXG4gIC5vcHRpb25hbCgpO1xuXG4vLyBDdWlzaW5lIHR5cGUgdmFsaWRhdGlvbiBzY2hlbWEgKG9wdGlvbmFsKVxuZXhwb3J0IGNvbnN0IGN1aXNpbmVUeXBlU2NoZW1hID0gelxuICAuc3RyaW5nKClcbiAgLm1heCg1MCwgJ0N1aXNpbmUgdHlwZSBpcyB0b28gbG9uZycpXG4gIC5vcHRpb25hbCgpO1xuXG4vLyBMb2dpbiByZXF1ZXN0IHZhbGlkYXRpb25cbmV4cG9ydCBjb25zdCBsb2dpblJlcXVlc3RTY2hlbWEgPSB6Lm9iamVjdCh7XG4gIGFjdGlvbjogei5saXRlcmFsKCdsb2dpbicpLFxuICBlbWFpbDogZW1haWxTY2hlbWEsXG4gIHBhc3N3b3JkOiB6LnN0cmluZygpLm1pbigxLCAnUGFzc3dvcmQgaXMgcmVxdWlyZWQnKVxufSk7XG5cbi8vIFJlZ2lzdHJhdGlvbiByZXF1ZXN0IHZhbGlkYXRpb25cbmV4cG9ydCBjb25zdCByZWdpc3RlclJlcXVlc3RTY2hlbWEgPSB6Lm9iamVjdCh7XG4gIGFjdGlvbjogei5saXRlcmFsKCdyZWdpc3RlcicpLFxuICBlbWFpbDogZW1haWxTY2hlbWEsXG4gIHBhc3N3b3JkOiBwYXNzd29yZFNjaGVtYSxcbiAgbmFtZTogbmFtZVNjaGVtYSxcbiAgcmVzdGF1cmFudE5hbWU6IHJlc3RhdXJhbnROYW1lU2NoZW1hLFxuICBjdWlzaW5lVHlwZTogY3Vpc2luZVR5cGVTY2hlbWEsXG4gIGxvY2F0aW9uOiBsb2NhdGlvblNjaGVtYSxcbiAgcGhvbmU6IHBob25lU2NoZW1hLFxuICBtYXJrZXRpbmdDb25zZW50OiB6LmJvb2xlYW4oKS5vcHRpb25hbCgpLmRlZmF1bHQoZmFsc2UpXG59KTtcblxuLy8gQXV0aCByZXF1ZXN0IHZhbGlkYXRpb24gKHVuaW9uIG9mIGxvZ2luIGFuZCByZWdpc3RlcilcbmV4cG9ydCBjb25zdCBhdXRoUmVxdWVzdFNjaGVtYSA9IHouZGlzY3JpbWluYXRlZFVuaW9uKCdhY3Rpb24nLCBbXG4gIGxvZ2luUmVxdWVzdFNjaGVtYSxcbiAgcmVnaXN0ZXJSZXF1ZXN0U2NoZW1hXG5dKTtcblxuLy8gUmVmcmVzaCB0b2tlbiByZXF1ZXN0IHZhbGlkYXRpb25cbmV4cG9ydCBjb25zdCByZWZyZXNoVG9rZW5SZXF1ZXN0U2NoZW1hID0gei5vYmplY3Qoe1xuICByZWZyZXNoVG9rZW46IHouc3RyaW5nKCkubWluKDEsICdSZWZyZXNoIHRva2VuIGlzIHJlcXVpcmVkJylcbn0pO1xuXG4vLyBVc2VyIHByb2ZpbGUgdXBkYXRlIHZhbGlkYXRpb25cbmV4cG9ydCBjb25zdCB1c2VyUHJvZmlsZVVwZGF0ZVNjaGVtYSA9IHoub2JqZWN0KHtcbiAgbmFtZTogbmFtZVNjaGVtYS5vcHRpb25hbCgpLFxuICByZXN0YXVyYW50TmFtZTogcmVzdGF1cmFudE5hbWVTY2hlbWEub3B0aW9uYWwoKSxcbiAgY3Vpc2luZVR5cGU6IGN1aXNpbmVUeXBlU2NoZW1hLFxuICBsb2NhdGlvbjogbG9jYXRpb25TY2hlbWEsXG4gIHBob25lOiBwaG9uZVNjaGVtYSxcbiAgbWFya2V0aW5nQ29uc2VudDogei5ib29sZWFuKCkub3B0aW9uYWwoKVxufSkucmVmaW5lKFxuICAoZGF0YTogUmVjb3JkPHN0cmluZywgYW55PikgPT4gT2JqZWN0LnZhbHVlcyhkYXRhKS5zb21lKHZhbHVlID0+IHZhbHVlICE9PSB1bmRlZmluZWQpLFxuICB7IG1lc3NhZ2U6ICdBdCBsZWFzdCBvbmUgZmllbGQgbXVzdCBiZSBwcm92aWRlZCBmb3IgdXBkYXRlJyB9XG4pO1xuXG4vLyBVc2VyIElEIHZhbGlkYXRpb25cbmV4cG9ydCBjb25zdCB1c2VySWRTY2hlbWEgPSB6LnN0cmluZygpXG4gIC5taW4oMSwgJ1VzZXIgSUQgaXMgcmVxdWlyZWQnKVxuICAucmVnZXgoL151c2VyX1xcZCtfW2EtekEtWjAtOV0rJC8sICdJbnZhbGlkIHVzZXIgSUQgZm9ybWF0Jyk7XG5cbi8vIFJvbGUgdmFsaWRhdGlvblxuZXhwb3J0IGNvbnN0IHJvbGVTY2hlbWEgPSB6LmVudW0oWyd1c2VyJywgJ2FkbWluJywgJ21vZGVyYXRvciddKTtcblxuLy8gU3Vic2NyaXB0aW9uIHN0YXR1cyB2YWxpZGF0aW9uXG5leHBvcnQgY29uc3Qgc3Vic2NyaXB0aW9uU3RhdHVzU2NoZW1hID0gei5lbnVtKFtcbiAgJ3RyaWFsaW5nJywgJ2FjdGl2ZScsICdwYXN0X2R1ZScsICdjYW5jZWxlZCcsICd1bnBhaWQnXG5dKTtcblxuLy8gUGFnaW5hdGlvbiB2YWxpZGF0aW9uXG5leHBvcnQgY29uc3QgcGFnaW5hdGlvblNjaGVtYSA9IHoub2JqZWN0KHtcbiAgcGFnZTogei5jb2VyY2UubnVtYmVyKCkuaW50KCkubWluKDEpLmRlZmF1bHQoMSksXG4gIGxpbWl0OiB6LmNvZXJjZS5udW1iZXIoKS5pbnQoKS5taW4oMSkubWF4KDEwMCkuZGVmYXVsdCgxMClcbn0pO1xuXG4vLyBSYXRlIGxpbWl0aW5nIHZhbGlkYXRpb24gaGVscGVyc1xuZXhwb3J0IGNvbnN0IHJhdGVMaW1pdEtleVNjaGVtYSA9IHouc3RyaW5nKCkubWluKDEpLm1heCgyNTUpO1xuXG4vLyBHZW5lcmljIElEIHZhbGlkYXRpb25cbmV4cG9ydCBjb25zdCBpZFNjaGVtYSA9IHouc3RyaW5nKCkubWluKDEsICdJRCBpcyByZXF1aXJlZCcpO1xuXG4vLyBWYWxpZGF0aW9uIHV0aWxpdHkgZnVuY3Rpb25zXG5leHBvcnQgZnVuY3Rpb24gdmFsaWRhdGVJbnB1dDxUPihzY2hlbWE6IHouWm9kU2NoZW1hPFQ+LCBkYXRhOiB1bmtub3duKToge1xuICBzdWNjZXNzOiBib29sZWFuO1xuICBkYXRhPzogVDtcbiAgZXJyb3JzPzogUmVjb3JkPHN0cmluZywgc3RyaW5nPjtcbn0ge1xuICB0cnkge1xuICAgIGNvbnN0IHZhbGlkYXRlZERhdGEgPSBzY2hlbWEucGFyc2UoZGF0YSk7XG4gICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgZGF0YTogdmFsaWRhdGVkRGF0YSB9O1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIHouWm9kRXJyb3IpIHtcbiAgICAgIGNvbnN0IGVycm9yczogUmVjb3JkPHN0cmluZywgc3RyaW5nPiA9IHt9O1xuICAgICAgZXJyb3IuZXJyb3JzLmZvckVhY2goKGVycjogei5ab2RJc3N1ZSkgPT4ge1xuICAgICAgICBjb25zdCBwYXRoID0gZXJyLnBhdGguam9pbignLicpO1xuICAgICAgICBlcnJvcnNbcGF0aF0gPSBlcnIubWVzc2FnZTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9ycyB9O1xuICAgIH1cbiAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3JzOiB7IGdlbmVyYWw6ICdWYWxpZGF0aW9uIGZhaWxlZCcgfSB9O1xuICB9XG59XG5cbi8vIFNhbml0aXphdGlvbiBoZWxwZXJzXG5leHBvcnQgZnVuY3Rpb24gc2FuaXRpemVTdHJpbmcoaW5wdXQ6IHN0cmluZyB8IHVuZGVmaW5lZCB8IG51bGwpOiBzdHJpbmcge1xuICBpZiAoIWlucHV0KSByZXR1cm4gJyc7XG4gIHJldHVybiBpbnB1dC50cmltKCkucmVwbGFjZSgvXFxzKy9nLCAnICcpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gc2FuaXRpemVFbWFpbChlbWFpbDogc3RyaW5nKTogc3RyaW5nIHtcbiAgcmV0dXJuIGVtYWlsLnRvTG93ZXJDYXNlKCkudHJpbSgpO1xufVxuXG4vLyBQYXNzd29yZCBzdHJlbmd0aCB2YWxpZGF0aW9uXG5leHBvcnQgZnVuY3Rpb24gZ2V0UGFzc3dvcmRTdHJlbmd0aChwYXNzd29yZDogc3RyaW5nKToge1xuICBzY29yZTogbnVtYmVyO1xuICBmZWVkYmFjazogc3RyaW5nW107XG59IHtcbiAgY29uc3QgZmVlZGJhY2s6IHN0cmluZ1tdID0gW107XG4gIGxldCBzY29yZSA9IDA7XG5cbiAgaWYgKHBhc3N3b3JkLmxlbmd0aCA+PSA4KSBzY29yZSArPSAxO1xuICBlbHNlIGZlZWRiYWNrLnB1c2goJ1VzZSBhdCBsZWFzdCA4IGNoYXJhY3RlcnMnKTtcblxuICBpZiAoL1thLXpdLy50ZXN0KHBhc3N3b3JkKSkgc2NvcmUgKz0gMTtcbiAgZWxzZSBmZWVkYmFjay5wdXNoKCdJbmNsdWRlIGxvd2VyY2FzZSBsZXR0ZXJzJyk7XG5cbiAgaWYgKC9bQS1aXS8udGVzdChwYXNzd29yZCkpIHNjb3JlICs9IDE7XG4gIGVsc2UgZmVlZGJhY2sucHVzaCgnSW5jbHVkZSB1cHBlcmNhc2UgbGV0dGVycycpO1xuXG4gIGlmICgvXFxkLy50ZXN0KHBhc3N3b3JkKSkgc2NvcmUgKz0gMTtcbiAgZWxzZSBmZWVkYmFjay5wdXNoKCdJbmNsdWRlIG51bWJlcnMnKTtcblxuICBpZiAoL1teYS16QS1aMC05XS8udGVzdChwYXNzd29yZCkpIHNjb3JlICs9IDE7XG4gIGVsc2UgZmVlZGJhY2sucHVzaCgnSW5jbHVkZSBzcGVjaWFsIGNoYXJhY3RlcnMnKTtcblxuICBpZiAocGFzc3dvcmQubGVuZ3RoID49IDEyKSBzY29yZSArPSAxO1xuICBcbiAgcmV0dXJuIHsgc2NvcmUsIGZlZWRiYWNrIH07XG59XG5cbi8vIENvbW1vbiBlcnJvciBtZXNzYWdlc1xuZXhwb3J0IGNvbnN0IEVSUk9SX01FU1NBR0VTID0ge1xuICBSRVFVSVJFRF9GSUVMRDogJ1RoaXMgZmllbGQgaXMgcmVxdWlyZWQnLFxuICBJTlZBTElEX0VNQUlMOiAnUGxlYXNlIGVudGVyIGEgdmFsaWQgZW1haWwgYWRkcmVzcycsXG4gIFdFQUtfUEFTU1dPUkQ6ICdQYXNzd29yZCBkb2VzIG5vdCBtZWV0IHNlY3VyaXR5IHJlcXVpcmVtZW50cycsXG4gIElOVkFMSURfUEhPTkU6ICdQbGVhc2UgZW50ZXIgYSB2YWxpZCBwaG9uZSBudW1iZXInLFxuICBNQVhfTEVOR1RIX0VYQ0VFREVEOiAnSW5wdXQgaXMgdG9vIGxvbmcnLFxuICBJTlZBTElEX0ZPUk1BVDogJ0ludmFsaWQgZm9ybWF0JyxcbiAgVVNFUl9FWElTVFM6ICdBIHVzZXIgd2l0aCB0aGlzIGVtYWlsIGFscmVhZHkgZXhpc3RzJyxcbiAgVVNFUl9OT1RfRk9VTkQ6ICdVc2VyIG5vdCBmb3VuZCcsXG4gIElOVkFMSURfQ1JFREVOVElBTFM6ICdJbnZhbGlkIGVtYWlsIG9yIHBhc3N3b3JkJyxcbiAgVU5BVVRIT1JJWkVEOiAnWW91IGFyZSBub3QgYXV0aG9yaXplZCB0byBwZXJmb3JtIHRoaXMgYWN0aW9uJyxcbiAgUkFURV9MSU1JVF9FWENFRURFRDogJ1RvbyBtYW55IHJlcXVlc3RzLiBQbGVhc2UgdHJ5IGFnYWluIGxhdGVyLicsXG4gIElOVEVSTkFMX0VSUk9SOiAnQW4gaW50ZXJuYWwgZXJyb3Igb2NjdXJyZWQuIFBsZWFzZSB0cnkgYWdhaW4uJ1xufSBhcyBjb25zdDsgIl0sIm5hbWVzIjpbInoiLCJlbWFpbFNjaGVtYSIsInN0cmluZyIsImVtYWlsIiwibWluIiwibWF4IiwicGFzc3dvcmRTY2hlbWEiLCJyZWdleCIsIm5hbWVTY2hlbWEiLCJyZXN0YXVyYW50TmFtZVNjaGVtYSIsInBob25lU2NoZW1hIiwib3B0aW9uYWwiLCJyZWZpbmUiLCJwaG9uZSIsInRlc3QiLCJyZXBsYWNlIiwibGVuZ3RoIiwibG9jYXRpb25TY2hlbWEiLCJjdWlzaW5lVHlwZVNjaGVtYSIsImxvZ2luUmVxdWVzdFNjaGVtYSIsIm9iamVjdCIsImFjdGlvbiIsImxpdGVyYWwiLCJwYXNzd29yZCIsInJlZ2lzdGVyUmVxdWVzdFNjaGVtYSIsIm5hbWUiLCJyZXN0YXVyYW50TmFtZSIsImN1aXNpbmVUeXBlIiwibG9jYXRpb24iLCJtYXJrZXRpbmdDb25zZW50IiwiYm9vbGVhbiIsImRlZmF1bHQiLCJhdXRoUmVxdWVzdFNjaGVtYSIsImRpc2NyaW1pbmF0ZWRVbmlvbiIsInJlZnJlc2hUb2tlblJlcXVlc3RTY2hlbWEiLCJyZWZyZXNoVG9rZW4iLCJ1c2VyUHJvZmlsZVVwZGF0ZVNjaGVtYSIsImRhdGEiLCJPYmplY3QiLCJ2YWx1ZXMiLCJzb21lIiwidmFsdWUiLCJ1bmRlZmluZWQiLCJtZXNzYWdlIiwidXNlcklkU2NoZW1hIiwicm9sZVNjaGVtYSIsImVudW0iLCJzdWJzY3JpcHRpb25TdGF0dXNTY2hlbWEiLCJwYWdpbmF0aW9uU2NoZW1hIiwicGFnZSIsImNvZXJjZSIsIm51bWJlciIsImludCIsImxpbWl0IiwicmF0ZUxpbWl0S2V5U2NoZW1hIiwiaWRTY2hlbWEiLCJ2YWxpZGF0ZUlucHV0Iiwic2NoZW1hIiwidmFsaWRhdGVkRGF0YSIsInBhcnNlIiwic3VjY2VzcyIsImVycm9yIiwiWm9kRXJyb3IiLCJlcnJvcnMiLCJmb3JFYWNoIiwiZXJyIiwicGF0aCIsImpvaW4iLCJnZW5lcmFsIiwic2FuaXRpemVTdHJpbmciLCJpbnB1dCIsInRyaW0iLCJzYW5pdGl6ZUVtYWlsIiwidG9Mb3dlckNhc2UiLCJnZXRQYXNzd29yZFN0cmVuZ3RoIiwiZmVlZGJhY2siLCJzY29yZSIsInB1c2giLCJFUlJPUl9NRVNTQUdFUyIsIlJFUVVJUkVEX0ZJRUxEIiwiSU5WQUxJRF9FTUFJTCIsIldFQUtfUEFTU1dPUkQiLCJJTlZBTElEX1BIT05FIiwiTUFYX0xFTkdUSF9FWENFRURFRCIsIklOVkFMSURfRk9STUFUIiwiVVNFUl9FWElTVFMiLCJVU0VSX05PVF9GT1VORCIsIklOVkFMSURfQ1JFREVOVElBTFMiLCJVTkFVVEhPUklaRUQiLCJSQVRFX0xJTUlUX0VYQ0VFREVEIiwiSU5URVJOQUxfRVJST1IiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/validation.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/stripe","vendor-chunks/semver","vendor-chunks/next","vendor-chunks/jsonwebtoken","vendor-chunks/zod","vendor-chunks/math-intrinsics","vendor-chunks/es-errors","vendor-chunks/qs","vendor-chunks/jws","vendor-chunks/call-bind-apply-helpers","vendor-chunks/get-proto","vendor-chunks/object-inspect","vendor-chunks/has-symbols","vendor-chunks/gopd","vendor-chunks/function-bind","vendor-chunks/ecdsa-sig-formatter","vendor-chunks/bcryptjs","vendor-chunks/side-channel","vendor-chunks/side-channel-weakmap","vendor-chunks/side-channel-map","vendor-chunks/side-channel-list","vendor-chunks/safe-buffer","vendor-chunks/ms","vendor-chunks/lodash.once","vendor-chunks/lodash.isstring","vendor-chunks/lodash.isplainobject","vendor-chunks/lodash.isnumber","vendor-chunks/lodash.isinteger","vendor-chunks/lodash.isboolean","vendor-chunks/lodash.includes","vendor-chunks/jwa","vendor-chunks/hasown","vendor-chunks/get-intrinsic","vendor-chunks/es-object-atoms","vendor-chunks/es-define-property","vendor-chunks/dunder-proto","vendor-chunks/call-bound","vendor-chunks/buffer-equal-constant-time"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fauth%2Froute&page=%2Fapi%2Fauth%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fauth%2Froute.ts&appDir=%2FUsers%2Fpierre-marccardinal%2FDocuments%2Fchefsocial-voice%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fpierre-marccardinal%2FDocuments%2Fchefsocial-voice&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();