<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChefSocial AI - Marketing Assistant</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&family=Source+Sans+Pro:wght@300;400;500;600&display=swap');
        
        body {
            font-family: 'Source Sans Pro', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #fff7ed 0%, #ffffff 50%, #fef2f2 100%);
            color: #374151;
            min-height: 100vh;
        }
        
        /* Header */
        header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            border-bottom: 1px solid rgba(234, 88, 12, 0.1);
        }

        .header-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 2rem;
            max-width: 1200px;
            margin: 0 auto;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.5rem;
            font-weight: 700;
            color: #374151;
            text-decoration: none;
        }

        .logo-icon {
            font-size: 2rem;
            color: #ea580c;
            transition: transform 0.3s ease;
        }

        .logo:hover .logo-icon {
            transform: scale(1.1);
            color: #dc2626;
        }

        .nav-links {
            display: flex;
            list-style: none;
            gap: 2rem;
            align-items: center;
            margin: 0;
            padding: 0;
        }

        .nav-links a {
            text-decoration: none;
            color: #6b7280;
            font-weight: 500;
            transition: color 0.3s ease;
        }

        .nav-links a:hover {
            color: #ea580c;
        }

        .cta-button {
            background: linear-gradient(to right, #ea580c, #dc2626);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 25px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(234, 88, 12, 0.3);
        }

        .cta-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(234, 88, 12, 0.4);
        }
        
        .main-content {
            margin-top: 80px;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
            box-shadow: 0 20px 40px rgba(234, 88, 12, 0.1);
            border: 1px solid rgba(234, 88, 12, 0.1);
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-family: 'Poppins', sans-serif;
            margin: 0;
            font-size: 2.5em;
            font-weight: 700;
            color: #374151;
        }
        
        .header h1 .accent {
            color: #ea580c;
        }
        
        .conversation-area {
            background: #ffffff;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            max-height: 400px;
            overflow-y: auto;
            color: #374151;
            border: 1px solid #fed7aa;
        }
        
        .message {
            margin: 15px 0;
            padding: 12px 16px;
            border-radius: 12px;
            max-width: 85%;
            line-height: 1.4;
            font-weight: 400;
        }
        
        .user-message {
            background: linear-gradient(to right, #ea580c, #dc2626);
            color: white;
            margin-left: auto;
            text-align: right;
        }
        
        .ai-message {
            background: #fff7ed;
            color: #374151;
            margin-right: auto;
            border: 1px solid #fed7aa;
        }
        
        .voice-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin: 30px 0;
        }
        
        .voice-button {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            border: none;
            background: linear-gradient(to right, #ea580c, #dc2626);
            color: white;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 10px 30px rgba(234, 88, 12, 0.3);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .voice-button:hover {
            transform: scale(1.05);
            box-shadow: 0 15px 35px rgba(234, 88, 12, 0.4);
        }
        
        .voice-button.recording {
            background: linear-gradient(to right, #dc2626, #b91c1c);
            animation: pulse 1.5s infinite;
        }
        
        .voice-button.disabled {
            background: #9ca3af;
            cursor: not-allowed;
            opacity: 0.6;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(234, 88, 12, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(234, 88, 12, 0); }
            100% { box-shadow: 0 0 0 0 rgba(234, 88, 12, 0); }
        }
        
        .status {
            text-align: center;
            font-size: 18px;
            margin: 20px 0;
            min-height: 30px;
            font-weight: 500;
            color: #6b7280;
        }
        
        .connection-status {
            text-align: center;
            padding: 12px;
            border-radius: 10px;
            margin: 10px 0;
            font-weight: 500;
        }
        
        .connected {
            background: #fff7ed;
            color: #ea580c;
            border: 1px solid #fed7aa;
        }
        
        .disconnected {
            background: #fef2f2;
            color: #dc2626;
            border: 1px solid #fecaca;
        }
        
        .audio-player {
            width: 100%;
            margin: 10px 0;
        }
        
        .feature-list {
            margin: 20px 0;
            padding: 20px;
            background: #fff7ed;
            border-radius: 10px;
            border: 1px solid #fed7aa;
        }
        
        .feature-list h3 {
            font-family: 'Poppins', sans-serif;
            margin-top: 0;
            color: #ea580c;
            font-weight: 600;
        }
        
        .feature-list ul {
            list-style: none;
            padding: 0;
        }
        
        .feature-list li {
            padding: 8px 0;
            border-bottom: 1px solid #fed7aa;
            color: #374151;
        }
        
        .feature-list li:last-child {
            border-bottom: none;
        }
        
        .feature-list li:before {
            content: "üçΩÔ∏è ";
            margin-right: 8px;
        }
        
        @media (max-width: 768px) {
            .nav-links {
                display: none;
            }
            
            .main-content {
                margin-top: 60px;
                padding: 10px;
            }
            
            .container {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <header>
        <nav class="header-nav">
            <a href="/index.html" class="logo">
                <span class="logo-icon">üë®‚Äçüç≥</span>
                ChefSocial Voice
            </a>
            <ul class="nav-links">
                <li><a href="/index.html">Home</a></li>
                <li><a href="/demo.html">Demo</a></li>
                <li><a href="/natural.html">Natural Conversation</a></li>
                <li><a href="/conversation.html">Basic Chat</a></li>
                <li><a href="/login.html">Login</a></li>
                <li><a href="/register.html" class="cta-button">Get Started</a></li>
            </ul>
        </nav>
    </header>

    <div class="main-content">
        <div class="container">
        <div class="header">
            <h1>üçΩÔ∏è Chef<span class="accent">Social</span> AI</h1>
            <p style="font-size: 1.1em; color: #6b7280; font-weight: 400;">Your Personal Restaurant Marketing Expert</p>
        </div>
        
        <div id="connectionStatus" class="connection-status disconnected">
            Connecting to your marketing assistant...
        </div>
        
        <div class="conversation-area" id="conversationArea">
            <div class="message ai-message">
                üëã Welcome! I'm your ChefSocial marketing expert. I'm ready to help you create amazing social media content for your restaurant. Just click the microphone and tell me what you'd like to work on today!
            </div>
        </div>
        
        <div class="voice-controls">
            <button id="voiceButton" class="voice-button disabled">
                üé§<br>Hold to Talk
            </button>
        </div>
        
        <div id="status" class="status">Click the microphone to start talking with your marketing assistant</div>
        
        <div class="feature-list">
            <h3>I can help you with:</h3>
            <ul>
                <li>Creating Instagram, TikTok, and Facebook content</li>
                <li>Developing marketing campaigns for special events</li>
                <li>Optimizing posting times and engagement strategies</li>
                <li>Writing compelling captions and choosing hashtags</li>
                <li>Planning seasonal and holiday promotions</li>
                <li>Analyzing your restaurant's unique brand voice</li>
                <li>Crisis management and reputation handling</li>
                <li>Competitive analysis and positioning advice</li>
            </ul>
        </div>
    </div>
    </div>

    <script>
        class ChefSocialConversation {
            constructor() {
                this.websocket = null;
                this.isRecording = false;
                this.mediaRecorder = null;
                this.audioChunks = [];
                this.sessionId = null;
                
                this.initializeElements();
                this.connectWebSocket();
                this.setupEventListeners();
            }
            
            initializeElements() {
                this.voiceButton = document.getElementById('voiceButton');
                this.status = document.getElementById('status');
                this.conversationArea = document.getElementById('conversationArea');
                this.connectionStatus = document.getElementById('connectionStatus');
            }
            
            connectWebSocket() {
                const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
                const wsUrl = `${protocol}//${window.location.host}/ws/conversation`;
                
                try {
                    this.websocket = new WebSocket(wsUrl);
                    
                    this.websocket.onopen = () => {
                        console.log('‚úÖ Connected to ChefSocial AI');
                        this.connectionStatus.textContent = 'üü¢ Connected to your marketing expert';
                        this.connectionStatus.className = 'connection-status connected';
                        this.voiceButton.classList.remove('disabled');
                        this.status.textContent = 'Ready! Hold the microphone to start our conversation';
                        
                        // Start conversation session
                        this.websocket.send(JSON.stringify({
                            type: 'start_session'
                        }));
                    };
                    
                    this.websocket.onmessage = (event) => {
                        const data = JSON.parse(event.data);
                        this.handleWebSocketMessage(data);
                    };
                    
                    this.websocket.onclose = () => {
                        console.log('‚ùå Disconnected from ChefSocial AI');
                        this.connectionStatus.textContent = 'üî¥ Disconnected - Reconnecting...';
                        this.connectionStatus.className = 'connection-status disconnected';
                        this.voiceButton.classList.add('disabled');
                        
                        // Attempt to reconnect after 3 seconds
                        setTimeout(() => this.connectWebSocket(), 3000);
                    };
                    
                    this.websocket.onerror = (error) => {
                        console.error('‚ùå WebSocket error:', error);
                        this.status.textContent = 'Connection error. Please refresh the page.';
                    };
                    
                } catch (error) {
                    console.error('‚ùå Failed to connect:', error);
                    this.connectionStatus.textContent = 'üî¥ Connection failed';
                    this.connectionStatus.className = 'connection-status disconnected';
                }
            }
            
            handleWebSocketMessage(data) {
                switch (data.type) {
                    case 'session_started':
                        this.sessionId = data.session_id;
                        this.addAIMessage(data.message);
                        break;
                        
                    case 'conversation_response':
                        if (data.transcript) {
                            this.addUserMessage(data.transcript);
                        }
                        if (data.response) {
                            this.addAIMessage(data.response);
                        }
                        if (data.audio_response) {
                            this.playAudioResponse(data.audio_response);
                        }
                        break;
                        
                    case 'error':
                        this.addAIMessage(`‚ùå ${data.message}`);
                        break;
                }
            }
            
            setupEventListeners() {
                // Voice button events
                this.voiceButton.addEventListener('mousedown', () => this.startRecording());
                this.voiceButton.addEventListener('mouseup', () => this.stopRecording());
                this.voiceButton.addEventListener('mouseleave', () => this.stopRecording());
                
                // Touch events for mobile
                this.voiceButton.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    this.startRecording();
                });
                this.voiceButton.addEventListener('touchend', (e) => {
                    e.preventDefault();
                    this.stopRecording();
                });
            }
            
            async startRecording() {
                if (this.isRecording || this.voiceButton.classList.contains('disabled')) return;
                
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    this.mediaRecorder = new MediaRecorder(stream);
                    this.audioChunks = [];
                    
                    this.mediaRecorder.ondataavailable = (event) => {
                        this.audioChunks.push(event.data);
                    };
                    
                    this.mediaRecorder.onstop = () => {
                        this.processRecording();
                    };
                    
                    this.mediaRecorder.start();
                    this.isRecording = true;
                    
                    this.voiceButton.classList.add('recording');
                    this.voiceButton.innerHTML = 'üî¥<br>Recording...';
                    this.status.textContent = 'Listening... Tell me about your restaurant marketing needs!';
                    
                } catch (error) {
                    this.status.textContent = 'Microphone access denied. Please allow microphone access.';
                    console.error('Error accessing microphone:', error);
                }
            }
            
            stopRecording() {
                if (!this.isRecording) return;
                
                this.mediaRecorder.stop();
                this.mediaRecorder.stream.getTracks().forEach(track => track.stop());
                this.isRecording = false;
                
                this.voiceButton.classList.remove('recording');
                this.voiceButton.innerHTML = 'üé§<br>Hold to Talk';
                this.status.textContent = 'Processing your message...';
            }
            
            async processRecording() {
                if (!this.websocket || this.websocket.readyState !== WebSocket.OPEN) {
                    this.status.textContent = 'Not connected. Please wait for connection.';
                    return;
                }
                
                const audioBlob = new Blob(this.audioChunks, { type: 'audio/wav' });
                
                try {
                    // Convert audio to base64
                    const arrayBuffer = await audioBlob.arrayBuffer();
                    const base64Audio = btoa(String.fromCharCode(...new Uint8Array(arrayBuffer)));
                    
                    // Send audio via WebSocket
                    this.websocket.send(JSON.stringify({
                        type: 'audio_chunk',
                        audio: base64Audio,
                        session_id: this.sessionId
                    }));
                    
                    this.status.textContent = 'Your marketing expert is responding...';
                    
                } catch (error) {
                    this.status.textContent = 'Error processing audio. Please try again.';
                    console.error('Processing error:', error);
                }
            }
            
            addUserMessage(message) {
                const messageEl = document.createElement('div');
                messageEl.className = 'message user-message';
                messageEl.textContent = message;
                this.conversationArea.appendChild(messageEl);
                this.scrollToBottom();
            }
            
            addAIMessage(message) {
                const messageEl = document.createElement('div');
                messageEl.className = 'message ai-message';
                messageEl.textContent = message;
                this.conversationArea.appendChild(messageEl);
                this.scrollToBottom();
                
                this.status.textContent = 'Ready for your next question!';
            }
            
            playAudioResponse(base64Audio) {
                try {
                    const audioData = atob(base64Audio);
                    const audioArray = new Uint8Array(audioData.length);
                    for (let i = 0; i < audioData.length; i++) {
                        audioArray[i] = audioData.charCodeAt(i);
                    }
                    
                    const audioBlob = new Blob([audioArray], { type: 'audio/mp3' });
                    const audioUrl = URL.createObjectURL(audioBlob);
                    
                    const audio = new Audio(audioUrl);
                    audio.play().catch(e => console.log('Audio playback failed:', e));
                    
                } catch (error) {
                    console.error('Audio playback error:', error);
                }
            }
            
            scrollToBottom() {
                this.conversationArea.scrollTop = this.conversationArea.scrollHeight;
            }
        }
        
        // Initialize the conversational interface when page loads
        document.addEventListener('DOMContentLoaded', () => {
            new ChefSocialConversation();
        });
    </script>
</body>
</html>